<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ í•™ìƒ ìˆ™ì œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ í•™ìƒ ìˆ™ì œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p>ì…ì²´ì–´íœ˜ 4000 & ì†Œë¦¬í›ˆë ¨ ì²´ê³„ì  ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        </div>

        <div class="controls">
            <div class="date-selector">
                <label for="homework-date">ğŸ“… ìˆ™ì œ ë‚ ì§œ:</label>
                <input type="date" id="homework-date" value="">
            </div>

            <div class="class-filter">
                <label for="class-filter">ğŸ“ ë°˜ í•„í„°:</label>
                <select id="class-filter">
                    <option value="all">ì „ì²´ ë°˜</option>
                </select>
            </div>

            <button class="export-btn" onclick="exportHomework()">
                ğŸ“Š CSV ë‚´ë³´ë‚´ê¸°
            </button>
            
            <button class="export-btn" onclick="exportClassHomework()" style="background: var(--success-color);">
                ğŸ“‹ ë°˜ë³„ ìˆ™ì œ ë³µì‚¬
            </button>
            
            <button class="export-btn" onclick="showSystemGuide()" style="background: var(--warning-color);">
                ğŸ“š ì‚¬ìš© ê°€ì´ë“œ
            </button>
            
            <button class="export-btn" onclick="backupData()" style="background: #13c2c2;">
                ğŸ’¾ ë°ì´í„° ë°±ì—…
            </button>
            
            <button class="export-btn" onclick="document.getElementById('restore-file').click()" style="background: #722ed1;">
                ğŸ“¥ ë°ì´í„° ë³µêµ¬
            </button>
            <input type="file" id="restore-file" accept=".json" style="display: none;" onchange="restoreData(event)">
            
            <button class="export-btn" onclick="showStudentManagement()" style="background: #eb2f96;">
                ğŸ‘¥ í•™ìƒ ê´€ë¦¬
            </button>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="total-students">0</div>
                <div class="stat-label">ì´ í•™ìƒ ìˆ˜</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="completed-homework">0</div>
                <div class="stat-label">ì™„ë£Œëœ ìˆ™ì œ</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="completion-rate">0%</div>
                <div class="stat-label">ì™„ë£Œìœ¨</div>
            </div>
        </div>

        <div class="bulk-actions">
            <h3>ğŸ“‹ ì¼ê´„ ì‘ì—…</h3>
            <div class="bulk-controls">
                <select id="bulk-class" class="bulk-select">
                    <option value="">ë°˜ ì„ íƒ</option>
                </select>
                <select id="bulk-category" class="bulk-select">
                    <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                    <option value="vocabulary">ì–´íœ˜</option>
                    <option value="phonics">ì†Œë¦¬</option>
                    <option value="reading">ë…ì„œ</option>
                    <option value="quizletEnabled">í€´ì¦ë¦¿ í™œì„±í™”</option>
                </select>
                <select id="bulk-homework" class="bulk-select">
                    <option value="">ìˆ™ì œ ì„ íƒ</option>
                </select>
                <button class="bulk-btn" onclick="applyBulkHomework()">
                    ğŸš€ ì¼ê´„ ì ìš©
                </button>
                <button class="bulk-btn" onclick="copyBulkHomework()" style="background: #1890ff;">
                    ğŸ“‹ ë°˜ë³„ ìˆ™ì œ ë³µì‚¬
                </button>
            </div>
        </div>

        <div id="classes-container">
            <!-- ë°˜ë³„ í•™ìƒ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <!-- JavaScript ëª¨ë“ˆ ë¡œë“œ -->
    <script src="js/data-manager.js"></script>
    <script src="js/ui-manager.js"></script>
    <script src="js/feedback-manager.js"></script>
    <script src="js/utilities.js"></script>

    <script>
        // í˜¸í™˜ì„±ì„ ìœ„í•œ ë¸Œë¦¬ì§€ í•¨ìˆ˜ë“¤
        function updateHomework(studentId, category, value) {
            dataManager.updateHomework(studentId, category, value);
        }
    </script>

    <!-- ìºì‹œ ë¬´íš¨í™” (ê°œë°œìš©) -->
    <!-- Cache-busting: 2025-01-22-05:29 - ëª¨ë“ˆí™” ì™„ë£Œ
        let studentsData = [
            { id: 1, class: "Halfmoon A", name: "ì „ì£¼í˜•", school: "ì•ˆì¼ì´ˆ", grade: "ì´ˆ4" },
            { id: 2, class: "Halfmoon A", name: "ê¹€ì‹œì€", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ4" },
            { id: 3, class: "Halfmoon A", name: "ê¹€ì§€ìš°", school: "ì•ˆì–‘ë™ì´ˆ", grade: "ì´ˆ3" },
            { id: 4, class: "Halfmoon A", name: "ì´ë„í›„", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ4" },
            { id: 5, class: "NewMoon A", name: "ë¬¸ëª¨ì•„", school: "", grade: "ì´ˆ1" },
            { id: 6, class: "NewMoon A", name: "ì´í•˜ëŒ", school: "", grade: "ì´ˆ3" },
            { id: 7, class: "NewMoon A", name: "í™©ì§€ìš±", school: "", grade: "ì´ˆ2" },
            { id: 8, class: "NewMoon C", name: "ê¹€ë¦¬ì•ˆ", school: "ì¤‘ì•™ì´ˆ", grade: "ì´ˆ2" },
            { id: 9, class: "NewMoon C", name: "ì–´ì¤€í˜", school: "", grade: "ì´ˆ2" },
            { id: 10, class: "NewMoon C", name: "ì–‘ì§€í›„", school: "ì¤‘ì•™ì´ˆ", grade: "ì´ˆ2" },
            { id: 11, class: "NewMoon C", name: "ì´ì§€í•œ", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ3" },
            { id: 12, class: "NewMoon C", name: "ì´ì§€í›ˆ", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ3" },
            { id: 13, class: "NewMoon C", name: "ì •ì±„ë¦°", school: "ì¤‘ì•™ì´ˆ", grade: "ì´ˆ2" },
            { id: 14, class: "ê°€ë‹ˆë©”ë°", name: "ê¹€ì‹œì—°", school: "ì„ê³¡ì¤‘", grade: "ì¤‘3" },
            { id: 16, class: "ê°€ë‹ˆë©”ë°", name: "ì‹ ë¯¼ê²½", school: "ë•ì²œì´ˆ", grade: "ì´ˆ6" },
            { id: 17, class: "ê°€ë‹ˆë©”ë°", name: "ì •í¬ì¤€", school: "í‰ì´Œê³ ", grade: "ê³ 1" },
            { id: 15, class: "ìœ ë¡œíŒŒ A", name: "ê¹€ì •ìš°", school: "ì„ê³±ì¤‘", grade: "ì¤‘3" },
            { id: 19, class: "ìœ ë¡œíŒŒ A", name: "ê¹€ì˜ˆì§€", school: "ì•ˆì–‘ì™¸ê³ ", grade: "ê³ 1" },
            { id: 21, class: "ìœ ë¡œíŒŒ A", name: "ì‹ í˜„í˜¸", school: "í‰ì´Œê³ ", grade: "ê³ 1" },
            { id: 18, class: "ìœ ë¡œíŒŒ B", name: "ì¡°ìœ ì£¼", school: "ì„ê³±ì¤‘", grade: "ì¤‘1" },
            { id: 20, class: "ìœ ë¡œíŒŒ B", name: "ê¹€í•œìš¸", school: "ì„ê³±ì¤‘", grade: "ì¤‘3" },
            { id: 22, class: "ìœ ë¡œíŒŒ B", name: "ì •ì§€ì—°", school: "ì„ê³±ì¤‘", grade: "ì¤‘3" },
            { id: 24, class: "ìœ ë¡œíŒŒ B", name: "ì¡°ìœ ì´", school: "ë¬¸í™”ì—¬ê³ ", grade: "ê³ 2" },
            { id: 25, class: "ì¹¼ë¦¬ìŠ¤í†  A", name: "ê¹€ì„ì¤€", school: "ì•ˆì–‘ë™ì´ˆ", grade: "ì´ˆ6" },
            { id: 26, class: "ì¹¼ë¦¬ìŠ¤í†  A", name: "ê¹€ìŠ¹ì¤€", school: "ì•ˆì–‘ë™ì´ˆ", grade: "ì´ˆ6" },
            { id: 27, class: "ì¹¼ë¦¬ìŠ¤í†  A", name: "ê¹€ì˜¨ìœ ", school: "ì¤‘ì•™ì´ˆ", grade: "ì´ˆ6" },
            { id: 28, class: "ì¹¼ë¦¬ìŠ¤í†  A", name: "ì‹ ì•„ë¯¼", school: "ì•ˆì–‘ë™ì´ˆ", grade: "ì´ˆ6" },
            { id: 29, class: "ì¹¼ë¦¬ìŠ¤í†  A", name: "ì˜¤ì˜ˆì›", school: "ì¤‘ì•™ì´ˆ", grade: "ì´ˆ6" },
            { id: 30, class: "ì¹¼ë¦¬ìŠ¤í†  A", name: "í™ì£¼ì—°", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ5" },
            { id: 31, class: "ì¹¼ë¦¬ìŠ¤í†  B", name: "ê°•í˜„ì„œ", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ5" },
            { id: 32, class: "ì¹¼ë¦¬ìŠ¤í†  B", name: "ê¹€ì˜ˆê±´", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ5" },
            { id: 33, class: "ì¹¼ë¦¬ìŠ¤í†  B", name: "ê¹€ì€ì´", school: "ì¤‘ì•™ì´ˆ", grade: "ì´ˆ6" },
            { id: 34, class: "ì¹¼ë¦¬ìŠ¤í†  B", name: "ì„œë³´ë¯¼", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ5" },
            { id: 35, class: "ì¹¼ë¦¬ìŠ¤í†  B", name: "ì‹ ë°±ê²½", school: "ë•ì²œì´ˆ", grade: "ì´ˆ3" },
            { id: 37, class: "ì¹¼ë¦¬ìŠ¤í†  B", name: "ì •ì„¸ì§„", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ5" },
            { id: 69, class: "ì¹¼ë¦¬ìŠ¤í†  B", name: "ìµœì„œì¤€", school: "", grade: "" },
            { id: 38, class: "ì¹¼ë¦¬ìŠ¤í†  C", name: "êµ¬ë„ìœ¤", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ5" },
            { id: 39, class: "ì¹¼ë¦¬ìŠ¤í†  C", name: "ì‹ ì‹œí˜„", school: "ì•ˆì–‘ë™ì´ˆ", grade: "ì´ˆ5" },
            { id: 40, class: "ì¹¼ë¦¬ìŠ¤í†  C", name: "ì¡°ì€ì„œ", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ4" },
            { id: 68, class: "ì¹¼ë¦¬ìŠ¤í†  C", name: "ê¹€ìˆ˜ì¸", school: "", grade: "ì´ˆ5" },
            { id: 41, class: "í¬ë ˆì„¼íŠ¸", name: "ìš°ë„ì—°", school: "ë•ì²œì´ˆ", grade: "ì´ˆ3" },
            { id: 42, class: "í¬ë ˆì„¼íŠ¸ A", name: "êµ¬í•˜ë‚˜", school: "", grade: "" },
            { id: 43, class: "í¬ë ˆì„¼íŠ¸ A", name: "ê¹€ì‹œì›", school: "ë¹„ì‚°ì´ˆ", grade: "ì´ˆ1" },
            { id: 44, class: "í¬ë ˆì„¼íŠ¸ A", name: "ê¹€ì€ìœ ", school: "", grade: "ì´ˆ3" },
            { id: 45, class: "í¬ë ˆì„¼íŠ¸ A", name: "ë°±ì„œì¤€", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ4" },
            { id: 47, class: "í¬ë ˆì„¼íŠ¸ A", name: "ì „ì œì´", school: "ì•ˆì–‘ë™ì´ˆ", grade: "ì´ˆ3" },
            { id: 48, class: "í¬ë ˆì„¼íŠ¸ B", name: "ê¹€ë³´ê²¸", school: "ì¤‘ì•™ì´ˆ", grade: "ì´ˆ3" },
            { id: 49, class: "í¬ë ˆì„¼íŠ¸ B", name: "ê¹€ì§€ì˜¤", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ2" },
            { id: 50, class: "í¬ë ˆì„¼íŠ¸ B", name: "ë¬¸ì•„ëŠ˜", school: "ì•ˆì–‘ì´ˆ", grade: "ì´ˆ2" },
            { id: 51, class: "í¬ë ˆì„¼íŠ¸ C", name: "ê¹€ìœ¤ì•„", school: "ì•ˆì–‘ë™ì´ˆ", grade: "ì´ˆ4" },
            { id: 52, class: "í¬ë ˆì„¼íŠ¸ C", name: "ë°•ìœ ì£¼", school: "ì¤‘ì•™ì´ˆ", grade: "ì´ˆ2" },
            { id: 53, class: "í¬ë ˆì„¼íŠ¸ C", name: "ì„œì—¬ìœ¨", school: "", grade: "ì´ˆ3" },
            { id: 54, class: "í¬ë ˆì„¼íŠ¸ C", name: "ì‹ ìœ ì£¼", school: "", grade: "ì´ˆ4" },
            { id: 55, class: "í¬ë ˆì„¼íŠ¸ C", name: "ì–‘ìŠ¹ìœ ", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ1" },
            { id: 56, class: "í¬ë ˆì„¼íŠ¸ C", name: "ì´ìŠ¹ì¤€", school: "ìƒ˜ëª¨ë£¨ì´ˆ", grade: "ì´ˆ2" },
            { id: 57, class: "í¬ë ˆì„¼íŠ¸ C", name: "ìµœì¤€ëª…", school: "ì•ˆì–‘ë™ì´ˆ", grade: "ì´ˆ4" },
            { id: 59, class: "íƒ€ì´íƒ„ A", name: "ê¹€ì •ë¯¼", school: "ì„ê³±ì¤‘", grade: "ì¤‘1" },
            { id: 60, class: "íƒ€ì´íƒ„ A", name: "ì „ì„¤ìš°", school: "ì„ê³±ì¤‘", grade: "ì¤‘1" },
            { id: 61, class: "íƒ€ì´íƒ„ B", name: "ê°•í˜„ìš°", school: "ë¹„ì‚°ì¤‘", grade: "ì¤‘1" },
            { id: 62, class: "íƒ€ì´íƒ„ B", name: "ê²½ì„œí˜„", school: "ì„ê³¡ì¤‘", grade: "ì¤‘1" },
            { id: 63, class: "íƒ€ì´íƒ„ B", name: "ë°•ê°€ì˜¨", school: "ë¶€í¥ì¤‘", grade: "ì¤‘1" },
            { id: 64, class: "íƒ€ì´íƒ„ B", name: "ì˜¤ì„œí•œ", school: "ë¶€í¥ì¤‘", grade: "ì¤‘1" },
            { id: 65, class: "íƒ€ì´íƒ„ B", name: "ì´ì¢…í›ˆ", school: "ë¶€í¥ì¤‘", grade: "ì¤‘1" },
            { id: 66, class: "íƒ€ì´íƒ„ B", name: "ì •í˜œì›", school: "ì„ê³¡ì¤‘", grade: "ì¤‘1" },
            { id: 67, class: "íƒ€ì´íƒ„ B", name: "ì¡°í•˜ëŒ", school: "ì„ê³¡ì¤‘", grade: "ì¤‘1" }
        ];

        // ì…ì²´ì–´íœ˜ 4000 ë‹¨ì–´ ì‹œìŠ¤í…œ (ìˆ˜ì •ëœ ë²„ì „)
        const vocabularyOptions = (() => {
            const options = [];
            for (let unit = 1; unit <= 40; unit++) {
                const baseNumber = (unit - 1) * 100;
                
                // 1ì°¨ - í”Œë˜ì‹œì¹´ë“œ (1-50, 51-100)
                options.push({
                    value: `unit${unit}_stage1_flashcard1`,
                    text: `Unit ${unit} - 1ì°¨ í”Œë˜ì‹œì¹´ë“œ (${baseNumber + 1}-${baseNumber + 50})`,
                    unit: unit,
                    stage: 1,
                    type: 'flashcard',
                    part: 1
                });
                options.push({
                    value: `unit${unit}_stage1_flashcard2`,
                    text: `Unit ${unit} - 1ì°¨ í”Œë˜ì‹œì¹´ë“œ (${baseNumber + 51}-${baseNumber + 100})`,
                    unit: unit,
                    stage: 1,
                    type: 'flashcard',
                    part: 2
                });
                
                // 2ì°¨ - ì˜ë¯¸ì‹œí—˜ (1-50, 51-100)
                options.push({
                    value: `unit${unit}_stage2_meaning1`,
                    text: `Unit ${unit} - 2ì°¨ ì˜ë¯¸ì‹œí—˜ (${baseNumber + 1}-${baseNumber + 50})`,
                    unit: unit,
                    stage: 2,
                    type: 'meaning',
                    part: 1
                });
                options.push({
                    value: `unit${unit}_stage2_meaning2`,
                    text: `Unit ${unit} - 2ì°¨ ì˜ë¯¸ì‹œí—˜ (${baseNumber + 51}-${baseNumber + 100})`,
                    unit: unit,
                    stage: 2,
                    type: 'meaning',
                    part: 2
                });
                
                // 3ì°¨ - ìŠ¤í ë§ì‹œí—˜ (1-25, 26-50, 51-75, 76-100)
                for (let part = 1; part <= 4; part++) {
                    const startNum = baseNumber + (part - 1) * 25 + 1;
                    const endNum = baseNumber + part * 25;
                    options.push({
                        value: `unit${unit}_stage3_spelling${part}`,
                        text: `Unit ${unit} - 3ì°¨ ìŠ¤í ë§ì‹œí—˜ (${startNum}-${endNum})`,
                        unit: unit,
                        stage: 3,
                        type: 'spelling',
                        part: part
                    });
                }
            }
            return options;
        })();

        // ì…ì²´ì–´íœ˜ ê°’ì„ ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function formatVocabularyText(value) {
            if (!value) return '';
            
            const option = vocabularyOptions.find(opt => opt.value === value);
            return option ? option.text : value;
        }

        // ì†Œë¦¬í›ˆë ¨ ì‹œìŠ¤í…œ (ìˆ˜ì •ëœ ë²„ì „)
        const phonicsOptions = [
            { value: 'cory_best_friend', text: '[Cory Carson] Chrissey\'s Best Friend' },
            { value: 'charlie_pancake', text: '[Charlie\'s Colorforms City] Charlie\'s Pancake Chef' },
            { value: 'chip_morning', text: '[Chip and Potato] Morning Potato' },
            { value: 'spirit_thunder', text: '[Spirit Rangers] Thunder Mountain' },
            { value: 'cory_first_day', text: '[Cory Carson] Cory\'s First Day' },
            { value: 'clifford_get_well', text: '[Clifford] Get Well' },
            { value: 'clifford_mimi', text: '[Clifford] Mimi\'s Back In Town' },
            { value: 'clifford_dog_day', text: '[Clifford] Dog for a Day' },
            { value: 'clifford_mess', text: '[Clifford] Another Fine Mess' },
            { value: 'arthur_mr_rogers', text: '[Arthur] Arthur Meets Mr. Rogers' },
            { value: 'arthur_water_brain', text: '[Arthur] Water and the Brain' },
            { value: 'arthur_draw', text: '[Arthur] Draw' },
            { value: 'arthur_binky', text: '[Arthur] Binky Art Expert' },
            { value: 'charlie_brown_dog', text: '[Charlie Brown] He\'s Your Dog' },
            { value: 'charlie_brown_lucy', text: '[Charlie Brown] Lucy Must Be Traded' },
            { value: 'charlie_brown_happiness', text: '[Charlie Brown] Happiness Is a ...' },
            { value: 'hollow_season1', text: '[The Hollow] Season 1' },
            { value: 'talking_tom_audition', text: '[Talking Tom] The Audition' },
            { value: 'untalking_tom', text: '[UnTalking Tom] UnTalking Tom' },
            { value: 'bare_bears_stuff', text: '[We Bare Bears] Our Stuff' },
            { value: 'news_basic1', text: '[News] Basic 1' },
            { value: 'news_advanced', text: '[News] Advanced' }
        ];

        // ì „ì—­ ë³€ìˆ˜
        let currentDate = new Date().toISOString().split('T')[0];
        let homeworkData = {};
        let studentProgress = {}; // í•™ìƒë³„ ì§„ë„ ì¶”ì 

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadStudentsData();
            
            document.getElementById('homework-date').value = currentDate;
            populateClassFilter();
            populateBulkOptions();
            renderStudents();
            updateStats();
            
            document.getElementById('homework-date').addEventListener('change', onDateChange);
            document.getElementById('class-filter').addEventListener('change', onClassFilterChange);
            document.getElementById('bulk-category').addEventListener('change', onBulkCategoryChange);
            
            loadHomeworkData();
            loadStudentProgress();
        }

        function populateClassFilter() {
            const classFilter = document.getElementById('class-filter');
            const classes = [...new Set(studentsData.map(student => student.class))].sort();
            
            classes.forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                classFilter.appendChild(option);
            });
        }

        function populateBulkOptions() {
            const bulkClass = document.getElementById('bulk-class');
            const classes = [...new Set(studentsData.map(student => student.class))].sort();
            
            classes.forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                bulkClass.appendChild(option);
            });
        }

        function onBulkCategoryChange() {
            const category = document.getElementById('bulk-category').value;
            const bulkHomework = document.getElementById('bulk-homework');
            
            bulkHomework.innerHTML = '<option value="">ìˆ™ì œ ì„ íƒ</option>';
            
            if (category === 'vocabulary') {
                vocabularyOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.text;
                    bulkHomework.appendChild(optionElement);
                });
            } else if (category === 'phonics') {
                phonicsOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.text;
                    bulkHomework.appendChild(optionElement);
                });
            } else if (category === 'quizletEnabled') {
                const enableOption = document.createElement('option');
                enableOption.value = 'true';
                enableOption.textContent = 'í™œì„±í™”';
                bulkHomework.appendChild(enableOption);
                
                const disableOption = document.createElement('option');
                disableOption.value = 'false';
                disableOption.textContent = 'ë¹„í™œì„±í™”';
                bulkHomework.appendChild(disableOption);
            }
        }

        function renderStudents() {
            const container = document.getElementById('classes-container');
            const classFilter = document.getElementById('class-filter').value;
            
            let filteredStudents = studentsData;
            if (classFilter !== 'all') {
                filteredStudents = studentsData.filter(student => student.class === classFilter);
            }
            
            const groupedStudents = {};
            filteredStudents.forEach(student => {
                if (!groupedStudents[student.class]) {
                    groupedStudents[student.class] = [];
                }
                groupedStudents[student.class].push(student);
            });
            
            container.innerHTML = '';
            Object.keys(groupedStudents).sort().forEach(className => {
                const students = groupedStudents[className];
                const classSection = createClassSection(className, students);
                container.appendChild(classSection);
            });
        }

        function createClassSection(className, students) {
            const section = document.createElement('div');
            section.className = 'class-section';
            section.innerHTML = `
                <div class="class-header" onclick="toggleClass('${className}')">
                    <h2>${className}</h2>
                    <div class="class-info">
                        <span class="student-count">${students.length}ëª…</span>
                        <button class="toggle-btn" id="toggle-${className}">â–¼</button>
                    </div>
                </div>
                <div class="students-grid" id="students-${className}">
                    ${students.map(student => createStudentCard(student)).join('')}
                </div>
            `;
            return section;
        }

        function createStudentCard(student) {
            const homework = getHomeworkForStudent(student.id);
            const progress = getStudentProgress(student.id);
            
            // íŠ¹ì • ë°˜ë“¤ì— ëŒ€í•œ ë‹¤ë¥¸ UI
            const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
            const isSpecialClass = specialClasses.includes(student.class);
            
            if (isSpecialClass) {
                return `
                    <div class="student-card">
                        <div class="student-info">
                            <div>
                                <div class="student-name">${student.name}</div>
                                <div class="student-details">${student.school} ${student.grade}</div>
                                <div class="student-date">${new Date().toLocaleDateString('ko-KR')}</div>
                            </div>
                        </div>
                        
                        <div class="homework-section">
                            <div class="homework-item">
                                <div class="homework-label">ğŸ“ ì–´íœ˜ì‹œí—˜</div>
                                <input type="text" class="homework-input" 
                                       placeholder="ì–´íœ˜ì‹œí—˜ ì§„ë„ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                       value="${homework.vocabularyTest || ''}"
                                       onchange="updateHomework(${student.id}, 'vocabularyTest', this.value)">
                            </div>
                            
                            <div class="homework-item">
                                <div class="homework-label">ğŸ”¤ ì†Œë¦¬í›ˆë ¨</div>
                                <select class="homework-select" 
                                        onchange="updateHomework(${student.id}, 'phonics', this.value)">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    ${phonicsOptions.map(option => 
                                        `<option value="${option.value}" ${homework.phonics === option.value ? 'selected' : ''}>${option.text}</option>`
                                    ).join('')}
                                </select>
                                <div class="phonics-progress-input">
                                    <span>ë‹¤ìŒ ì§„ë„:</span>
                                    <input type="text" 
                                           placeholder="ì§„ë„ ì…ë ¥" 
                                           value="${homework.phonicsProgress || ''}"
                                           onchange="updateHomework(${student.id}, 'phonicsProgress', this.value)">
                                </div>
                            </div>
                            
                            <div class="homework-item">
                                <div class="homework-label">ğŸ“š ì›ì„œìˆ˜ì—…</div>
                                <input type="text" class="homework-input" 
                                       placeholder="ì›ì„œìˆ˜ì—… ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                       value="${homework.reading || ''}"
                                       onchange="updateHomework(${student.id}, 'reading', this.value)">
                            </div>
                            
                            <div class="homework-item">
                                <div class="homework-label">ğŸ“– ë¬¸ë²•</div>
                                <input type="text" class="homework-input" 
                                       placeholder="ë¬¸ë²• ìˆ™ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                       value="${homework.grammar || ''}"
                                       onchange="updateHomework(${student.id}, 'grammar', this.value)">
                            </div>
                        </div>
                        
                        <div class="evaluation-section" style="margin-bottom: 15px;">
                            <div class="homework-label">ğŸ“Š í‰ê°€ ê²°ê³¼</div>
                            <div style="display: flex; gap: 15px; margin-top: 10px; flex-wrap: wrap;">
                                <div class="custom-checkbox">
                                    <input type="checkbox" 
                                           id="vocab-pass-${student.id}"
                                           ${homework.vocabularyPass ? 'checked' : ''}
                                           onchange="updateHomework(${student.id}, 'vocabularyPass', this.checked)">
                                    <label for="vocab-pass-${student.id}">ğŸ“ ì–´íœ˜í•©ê²©</label>
                                </div>
                                <div class="custom-checkbox">
                                    <input type="checkbox" 
                                           id="phonics-pass-${student.id}"
                                           ${homework.phonicsPass ? 'checked' : ''}
                                           onchange="updateHomework(${student.id}, 'phonicsPass', this.checked)">
                                    <label for="phonics-pass-${student.id}">ğŸ”¤ ì†Œë¦¬í›ˆë ¨ í•©ê²©</label>
                                </div>
                                <div class="custom-checkbox">
                                    <input type="checkbox" 
                                           id="grammar-complete-${student.id}"
                                           ${homework.grammarComplete ? 'checked' : ''}
                                           onchange="updateHomework(${student.id}, 'grammarComplete', this.checked)">
                                    <label for="grammar-complete-${student.id}">ğŸ“– ë¬¸ë²•ìˆ™ì œ ì™„ë£Œ</label>
                                </div>
                                <div class="custom-checkbox">
                                    <input type="checkbox" 
                                           id="quizlet-pass-${student.id}"
                                           ${homework.quizletPass ? 'checked' : ''}
                                           onchange="updateHomework(${student.id}, 'quizletPass', this.checked)">
                                    <label for="quizlet-pass-${student.id}">ğŸ¯ í€´ì¦ë¦¿ í•©ê²©</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="feedback-section">
                            <div class="homework-label">ğŸ’¬ í”¼ë“œë°±</div>
                            <textarea class="feedback-textarea" 
                                      placeholder="í•™ìƒì—ê²Œ ì „ë‹¬í•  í”¼ë“œë°±ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                      onchange="updateHomework(${student.id}, 'feedback', this.value)">${homework.feedback || ''}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <button class="save-btn" onclick="saveStudentHomework(${student.id})" style="flex: 1;">
                                ğŸ’¾ ì €ì¥
                            </button>
                            <button class="save-btn" onclick="showProgressModal(${student.id})" style="flex: 1; background: #fa8c16;">
                                ğŸ“Š ì§„ë„ê´€ë¦¬
                            </button>
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <button class="save-btn" onclick="copyStudentHomework(${student.id})" style="flex: 1; background: #1890ff;">
                                ğŸ“‹ ë³µì‚¬
                            </button>
                            <button class="save-btn" onclick="printStudentHomework(${student.id})" style="flex: 1; background: #722ed1;">
                                ğŸ–¨ï¸ ì¸ì‡„
                            </button>
                            <button class="save-btn" onclick="showHomeworkSummary(${student.id})" style="flex: 1; background: #52c41a;">
                                ğŸ“„ ìš”ì•½
                            </button>
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <button class="save-btn" onclick="showParentFeedback(${student.id})" style="flex: 1; background: #fa541c;">
                                ğŸ“¨ ë¶€ëª¨ë‹˜ í”¼ë“œë°±
                            </button>
                            ${getHomeworkForStudent(student.id).finalized ?
                                `<button class="save-btn" style="flex: 1; background: #52c41a; opacity: 0.6;" disabled>
                                    âœ… ì™„ë£Œë¨
                                </button>` :
                                `<button class="save-btn" onclick="finalizeStudent(${student.id})" style="flex: 1; background: #13c2c2;">
                                    ğŸ¯ ìµœì¢…ì™„ë£Œ
                                </button>`
                            }
                        </div>
                    </div>
                `;
            }
            
            // ê¸°ì¡´ ë°˜ë“¤ì„ ìœ„í•œ ê¸°ë³¸ UI
            return `
                <div class="student-card">
                    <div class="student-info">
                        <div>
                            <div class="student-name">${student.name}</div>
                            <div class="student-details">${student.school} ${student.grade}</div>
                            <div class="student-date">${new Date().toLocaleDateString('ko-KR')}</div>
                        </div>
                    </div>
                    
                    <div class="homework-section">
                        <div class="homework-item">
                            <div class="homework-label">ğŸ“š ì–´íœ˜ (ì…ì²´ì–´íœ˜ 4000)</div>
                            <select class="homework-select" 
                                    onchange="updateHomework(${student.id}, 'vocabulary', this.value)">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                ${vocabularyOptions.map(option => 
                                    `<option value="${option.value}" ${homework.vocabulary === option.value ? 'selected' : ''}>${option.text}</option>`
                                ).join('')}
                            </select>
                            <div class="progress-indicator">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${calculateVocabularyProgress(student.id)}%"></div>
                                </div>
                                <div class="progress-text">${calculateVocabularyProgress(student.id)}%</div>
                            </div>
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-label">ğŸ”¤ ì†Œë¦¬í›ˆë ¨</div>
                            <select class="homework-select" 
                                    onchange="updateHomework(${student.id}, 'phonics', this.value)">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                ${phonicsOptions.map(option => 
                                    `<option value="${option.value}" ${homework.phonics === option.value ? 'selected' : ''}>${option.text}</option>`
                                ).join('')}
                            </select>
                            <div class="phonics-progress-input">
                                <span>ë‹¤ìŒ ì§„ë„:</span>
                                <input type="text" 
                                       placeholder="ì§„ë„ ì…ë ¥" 
                                       value="${homework.phonicsProgress || ''}"
                                       onchange="updateHomework(${student.id}, 'phonicsProgress', this.value)">
                            </div>
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-label">ğŸ“– ë…ì„œ</div>
                            <input type="text" class="homework-input" 
                                   placeholder="ì±… ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                                   value="${homework.reading || ''}"
                                   onchange="updateHomework(${student.id}, 'reading', this.value)">
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-label">ğŸ“– ë¬¸ë²•</div>
                            <input type="text" class="homework-input" 
                                   placeholder="ë¬¸ë²• ìˆ™ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                   value="${homework.grammar || ''}"
                                   onchange="updateHomework(${student.id}, 'grammar', this.value)">
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-label">âœï¸ ê¸°íƒ€</div>
                            <div class="quizlet-section">
                                <div class="custom-checkbox">
                                    <input type="checkbox" 
                                           id="quizlet-${student.id}"
                                           ${homework.quizletEnabled ? 'checked' : ''}
                                           onchange="updateHomework(${student.id}, 'quizletEnabled', this.checked)">
                                    <label for="quizlet-${student.id}">í€´ì¦ë¦¿ í•™ìŠµí•˜ê¸°</label>
                                </div>
                                <div class="custom-checkbox">
                                    <input type="checkbox" 
                                           id="prepare-quizlet-${student.id}"
                                           ${homework.prepareQuizlet ? 'checked' : ''}
                                           onchange="updateHomework(${student.id}, 'prepareQuizlet', this.checked)">
                                    <label for="prepare-quizlet-${student.id}">"í€´ì¦ë¦¿ ì‹œí—˜ì„ ì¤€ë¹„í•˜ì„¸ìš”" ë¬¸êµ¬</label>
                                </div>
                                <input type="url" class="homework-input" 
                                       placeholder="í€´ì¦ë¦¿ URLì„ ì…ë ¥í•˜ì„¸ìš”"
                                       value="${homework.quizletUrl || ''}"
                                       onchange="updateHomework(${student.id}, 'quizletUrl', this.value)"
                                       ${!homework.quizletEnabled ? 'disabled' : ''}>
                                <input type="text" class="homework-input" 
                                       placeholder="ê¸°íƒ€ ìˆ™ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                       value="${homework.other || ''}"
                                       onchange="updateHomework(${student.id}, 'other', this.value)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="evaluation-section" style="margin-bottom: 15px;">
                        <div class="homework-label">ğŸ“Š í‰ê°€ ê²°ê³¼</div>
                        <div style="display: flex; gap: 15px; margin-top: 10px;">
                            <div class="custom-checkbox">
                                <input type="checkbox" 
                                       id="vocab-pass-${student.id}"
                                       ${homework.vocabularyPass ? 'checked' : ''}
                                       onchange="updateHomework(${student.id}, 'vocabularyPass', this.checked)">
                                <label for="vocab-pass-${student.id}">ğŸ“š ì…ì²´ì–´íœ˜ í•©ê²©</label>
                            </div>
                            <div class="custom-checkbox">
                                <input type="checkbox" 
                                       id="phonics-pass-${student.id}"
                                       ${homework.phonicsPass ? 'checked' : ''}
                                       onchange="updateHomework(${student.id}, 'phonicsPass', this.checked)">
                                <label for="phonics-pass-${student.id}">ğŸ”¤ ì†Œë¦¬í›ˆë ¨ í•©ê²©</label>
                            </div>
                            <div class="custom-checkbox">
                                <input type="checkbox" 
                                       id="grammar-complete-${student.id}"
                                       ${homework.grammarComplete ? 'checked' : ''}
                                       onchange="updateHomework(${student.id}, 'grammarComplete', this.checked)">
                                <label for="grammar-complete-${student.id}">ğŸ“– ë¬¸ë²•ìˆ™ì œ ì™„ë£Œ</label>
                            </div>
                            <div class="custom-checkbox">
                                <input type="checkbox" 
                                       id="quizlet-pass-${student.id}"
                                       ${homework.quizletPass ? 'checked' : ''}
                                       onchange="updateHomework(${student.id}, 'quizletPass', this.checked)">
                                <label for="quizlet-pass-${student.id}">ğŸ¯ í€´ì¦ë¦¿ í•©ê²©</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="feedback-section">
                        <div class="homework-label">ğŸ’¬ í”¼ë“œë°±</div>
                        <textarea class="feedback-textarea" 
                                  placeholder="í•™ìƒì—ê²Œ ì „ë‹¬í•  í”¼ë“œë°±ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                  onchange="updateHomework(${student.id}, 'feedback', this.value)">${homework.feedback || ''}</textarea>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-top: 10px;">
                        <button class="save-btn" onclick="saveStudentHomework(${student.id})" style="flex: 1;">
                            ğŸ’¾ ì €ì¥
                        </button>
                        <button class="save-btn" onclick="showProgressModal(${student.id})" style="flex: 1; background: #fa8c16;">
                            ğŸ“Š ì§„ë„ê´€ë¦¬
                        </button>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button class="save-btn" onclick="copyStudentHomework(${student.id})" style="flex: 1; background: #1890ff;">
                            ğŸ“‹ ë³µì‚¬
                        </button>
                        <button class="save-btn" onclick="printStudentHomework(${student.id})" style="flex: 1; background: #722ed1;">
                            ğŸ–¨ï¸ ì¸ì‡„
                        </button>
                        <button class="save-btn" onclick="showHomeworkSummary(${student.id})" style="flex: 1; background: #52c41a;">
                            ğŸ“„ ìš”ì•½
                        </button>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 8px;">
                        <button class="save-btn" onclick="showParentFeedback(${student.id})" style="flex: 1; background: #fa541c;">
                            ğŸ“¨ ë¶€ëª¨ë‹˜ í”¼ë“œë°±
                        </button>
                        ${getHomeworkForStudent(student.id).finalized ?
                            `<button class="save-btn" style="flex: 1; background: #52c41a; opacity: 0.6;" disabled>
                                âœ… ì™„ë£Œë¨
                            </button>` :
                            `<button class="save-btn" onclick="finalizeStudent(${student.id})" style="flex: 1; background: #13c2c2;">
                                ğŸ¯ ìµœì¢…ì™„ë£Œ
                            </button>`
                        }
                    </div>
                </div>
            `;
        }

        function calculateVocabularyProgress(studentId) {
            const progress = getStudentProgress(studentId);
            const currentUnit = progress.vocabulary?.currentUnit || 1;
            const currentStage = progress.vocabulary?.currentStage || 1;
            const currentPart = progress.vocabulary?.currentPart || 1;
            
            // ì „ì²´ ì§„ë„ ê³„ì‚° (40 ìœ ë‹› Ã— 3 ë‹¨ê³„ Ã— í‰ê·  íŒŒíŠ¸)
            const totalProgress = ((currentUnit - 1) * 3 + (currentStage - 1) + (currentPart / 4)) / (40 * 3) * 100;
            return Math.min(100, Math.max(0, Math.round(totalProgress)));
        }

        function getStudentProgress(studentId) {
            if (!studentProgress[studentId]) {
                studentProgress[studentId] = {
                    vocabulary: { currentUnit: 1, currentStage: 1, currentPart: 1 }
                };
            }
            return studentProgress[studentId];
        }

        function showProgressModal(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            const progress = getStudentProgress(studentId);
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; width: 500px; max-width: 90%;" onclick="event.stopPropagation();">
                    <h3>${student.name} ì§„ë„ ê´€ë¦¬</h3>
                    
                    <div style="margin: 20px 0;">
                        <h4>ğŸ“š ì–´íœ˜ ì§„ë„</h4>
                        <div style="margin: 10px 0;">
                            <label>í˜„ì¬ ìœ ë‹›: </label>
                            <input type="number" id="vocab-unit" value="${progress.vocabulary.currentUnit}" min="1" max="40" style="width: 80px; padding: 5px;">
                        </div>
                        <div style="margin: 10px 0;">
                            <label>í˜„ì¬ ë‹¨ê³„: </label>
                            <select id="vocab-stage" style="padding: 5px;">
                                <option value="1" ${progress.vocabulary.currentStage === 1 ? 'selected' : ''}>1ì°¨ - í”Œë˜ì‹œì¹´ë“œ</option>
                                <option value="2" ${progress.vocabulary.currentStage === 2 ? 'selected' : ''}>2ì°¨ - ì˜ë¯¸ì‹œí—˜</option>
                                <option value="3" ${progress.vocabulary.currentStage === 3 ? 'selected' : ''}>3ì°¨ - ìŠ¤í ë§ì‹œí—˜</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="saveProgress(${studentId})" style="flex: 1; padding: 10px; background: #52c41a; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ğŸ’¾ ì €ì¥
                        </button>
                        <button onclick="closeProgressModal()" style="flex: 1; padding: 10px; background: #d9d9d9; color: black; border: none; border-radius: 5px; cursor: pointer;">
                            âŒ ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            `;
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeProgressModal();
                }
            };
            
            document.body.appendChild(modal);
            window.currentProgressModal = modal;
        }

        function saveProgress(studentId) {
            const vocabUnit = parseInt(document.getElementById('vocab-unit').value);
            const vocabStage = parseInt(document.getElementById('vocab-stage').value);
            
            studentProgress[studentId] = {
                vocabulary: { currentUnit: vocabUnit, currentStage: vocabStage, currentPart: 1 }
            };
            
            saveStudentProgress();
            closeProgressModal();
            renderStudents();
            showNotification('ì§„ë„ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        function closeProgressModal() {
            if (window.currentProgressModal) {
                document.body.removeChild(window.currentProgressModal);
                window.currentProgressModal = null;
            }
        }

        // í•™ìƒë³„ ìˆ™ì œ ë³µì‚¬ ê¸°ëŠ¥
        function copyStudentHomework(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            const homework = getHomeworkForStudent(studentId);
            const progress = getStudentProgress(studentId);
            
            const homeworkText = formatHomeworkText(student, homework, progress);
            
            navigator.clipboard.writeText(homeworkText).then(() => {
                showNotification(`${student.name} í•™ìƒì˜ ìˆ™ì œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        // í•™ìƒë³„ ìˆ™ì œ ì¸ì‡„ ê¸°ëŠ¥
        function printStudentHomework(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            const homework = getHomeworkForStudent(studentId);
            const progress = getStudentProgress(studentId);
            
            const printContent = formatHomeworkForPrint(student, homework, progress);
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${student.name} í•™ìƒ ìˆ™ì œ</title>
                    <style>
                        body { font-family: 'Malgun Gothic', sans-serif; margin: 20px; line-height: 1.6; }
                        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
                        .student-info { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                        .homework-section { margin-bottom: 20px; }
                        .homework-item { margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
                        .homework-title { font-weight: bold; color: #333; margin-bottom: 8px; }
                        .homework-content { margin-left: 20px; }
                        .progress-info { background: #e6f7ff; padding: 10px; border-radius: 5px; margin-top: 10px; }
                        .footer { margin-top: 30px; text-align: center; color: #666; font-size: 12px; }
                        @media print {
                            body { margin: 0; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    ${printContent}
                    <div class="footer">
                        <p>ì¸ì‡„ì¼: ${new Date().toLocaleDateString('ko-KR')} | í•™ìƒ ìˆ™ì œ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            // ë¡œë”© í›„ ìë™ ì¸ì‡„ ë‹¤ì´ì–¼ë¡œê·¸ ì—´ê¸°
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        // í•™ìƒë³„ ìˆ™ì œ ìš”ì•½ ëª¨ë‹¬
        function showHomeworkSummary(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            const homework = getHomeworkForStudent(studentId);
            const progress = getStudentProgress(studentId);
            
            const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
            const isSpecialClass = specialClasses.includes(student.class);
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            let summaryContent = '';
            
            if (isSpecialClass) {
                summaryContent = `
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #1890ff; margin-bottom: 15px;">ğŸ“ ì–´íœ˜ì‹œí—˜</h3>
                        <div style="margin-bottom: 10px;">
                            <strong>ì˜¤ëŠ˜ ìˆ™ì œ:</strong> ${homework.vocabularyTest || 'ì—†ìŒ'}
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #fa8c16; margin-bottom: 15px;">ğŸ”¤ ì†Œë¦¬í›ˆë ¨</h3>
                        <div style="margin-bottom: 10px;">
                            <strong>ì˜¤ëŠ˜ ìˆ™ì œ:</strong> ${homework.phonics || 'ì—†ìŒ'}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>ë‹¤ìŒ ì§„ë„:</strong> ${homework.phonicsProgress || 'ì—†ìŒ'}
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #52c41a; margin-bottom: 15px;">ğŸ“š ì›ì„œìˆ˜ì—… & ë¬¸ë²•</h3>
                        <div style="margin-bottom: 10px;">
                            <strong>ì›ì„œìˆ˜ì—…:</strong> ${homework.reading || 'ì—†ìŒ'}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>ë¬¸ë²• ìˆ™ì œ:</strong> ${homework.grammar || 'ì—†ìŒ'}
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #722ed1; margin-bottom: 15px;">ğŸ“Š í‰ê°€ ê²°ê³¼</h3>
                        <div style="margin-bottom: 10px;">
                            <strong>ì–´íœ˜í•©ê²©:</strong> 
                            <span style="color: ${homework.vocabularyPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                            </span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>ì†Œë¦¬í›ˆë ¨:</strong> 
                            <span style="color: ${homework.phonicsPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                            </span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>ë¬¸ë²•ìˆ™ì œ:</strong> 
                            <span style="color: ${homework.grammarComplete ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                ${homework.grammarComplete ? 'âœ… ì™„ë£Œ' : 'âŒ ë¯¸ì™„ë£Œ'}
                            </span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>í€´ì¦ë¦¿:</strong> 
                            <span style="color: ${homework.quizletPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                            </span>
                        </div>
                    </div>
                `;
            } else {
                summaryContent = `
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #1890ff; margin-bottom: 15px;">ğŸ“š ì–´íœ˜ (ì…ì²´ì–´íœ˜ 4000)</h3>
                        <div style="margin-bottom: 10px;">
                            <strong>ì˜¤ëŠ˜ ìˆ™ì œ:</strong> ${formatVocabularyText(homework.vocabulary) || 'ì—†ìŒ'}
                        </div>
                        <div style="background: #e6f7ff; padding: 10px; border-radius: 5px;">
                            <strong>ì§„ë„ìœ¨:</strong> ${calculateVocabularyProgress(studentId)}%
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #fa8c16; margin-bottom: 15px;">ğŸ”¤ ì†Œë¦¬í›ˆë ¨</h3>
                        <div style="margin-bottom: 10px;">
                            <strong>ì˜¤ëŠ˜ ìˆ™ì œ:</strong> ${homework.phonics || 'ì—†ìŒ'}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>ë‹¤ìŒ ì§„ë„:</strong> ${homework.phonicsProgress || 'ì—†ìŒ'}
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #52c41a; margin-bottom: 15px;">ğŸ“– ë…ì„œ & ê¸°íƒ€</h3>
                        <div style="margin-bottom: 10px;">
                            <strong>ë…ì„œ ìˆ™ì œ:</strong> ${homework.reading || 'ì—†ìŒ'}
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>í€´ì¦ë¦¿ í•™ìŠµ:</strong> ${homework.quizletEnabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}
                        </div>
                        ${homework.quizletUrl ? `
                        <div style="margin-bottom: 10px;">
                            <strong>í€´ì¦ë¦¿ URL:</strong> <a href="${homework.quizletUrl}" target="_blank">${homework.quizletUrl}</a>
                        </div>
                        ` : ''}
                        ${homework.prepareQuizlet ? `
                        <div style="margin-bottom: 10px;">
                            <strong>ì•ˆë‚´:</strong> "í€´ì¦ë¦¿ ì‹œí—˜ì„ ì¤€ë¹„í•˜ì„¸ìš”"
                        </div>
                        ` : ''}
                        <div style="margin-bottom: 10px;">
                            <strong>ê¸°íƒ€ ìˆ™ì œ:</strong> ${homework.other || 'ì—†ìŒ'}
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #722ed1; margin-bottom: 15px;">ğŸ“Š í‰ê°€ ê²°ê³¼</h3>
                        <div style="margin-bottom: 10px;">
                            <strong>ì…ì²´ì–´íœ˜:</strong> 
                            <span style="color: ${homework.vocabularyPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                            </span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>ì†Œë¦¬í›ˆë ¨:</strong> 
                            <span style="color: ${homework.phonicsPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                            </span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>í€´ì¦ë¦¿:</strong> 
                            <span style="color: ${homework.quizletPass ? 'âœ… í•©ê²©' : '#f5222d'}; font-weight: 600;">
                                ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                            </span>
                        </div>
                    </div>
                `;
            }
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; width: 600px; max-width: 90%; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation();">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <h2 style="color: #333; margin-bottom: 10px;">ğŸ“‹ ${student.name} í•™ìƒ ìˆ™ì œ ìš”ì•½</h2>
                        <p style="color: #666;">${student.school} ${student.grade} | ${currentDate}</p>
                    </div>
                    
                    ${summaryContent}
                    
                    ${homework.feedback ? `
                    <div style="background: #f6ffed; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h3 style="color: #389e0d; margin-bottom: 15px;">ğŸ’¬ í”¼ë“œë°±</h3>
                        <div style="white-space: pre-wrap; line-height: 1.5;">${homework.feedback}</div>
                    </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 10px; margin-top: 25px;">
                        <button onclick="copyFromSummary(${studentId})" style="flex: 1; padding: 12px; background: #1890ff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                            ğŸ“‹ ë³µì‚¬í•˜ê¸°
                        </button>
                        <button onclick="printFromSummary(${studentId})" style="flex: 1; padding: 12px; background: #722ed1; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                            ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
                        </button>
                        <button onclick="closeSummaryModal()" style="flex: 1; padding: 12px; background: #d9d9d9; color: black; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;">
                            âŒ ë‹«ê¸°
                        </button>
                    </div>
                </div>
            `;
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeSummaryModal();
                }
            };
            
            document.body.appendChild(modal);
            window.currentSummaryModal = modal;
        }

        function copyFromSummary(studentId) {
            copyStudentHomework(studentId);
        }

        function printFromSummary(studentId) {
            printStudentHomework(studentId);
        }

        function closeSummaryModal() {
            if (window.currentSummaryModal) {
                document.body.removeChild(window.currentSummaryModal);
                window.currentSummaryModal = null;
            }
        }

        // ìˆ™ì œ í…ìŠ¤íŠ¸ í¬ë§·íŒ…
        function formatHomeworkText(student, homework, progress) {
            const date = new Date(currentDate).toLocaleDateString('ko-KR');
            
            const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
            const isSpecialClass = specialClasses.includes(student.class);
            
            if (isSpecialClass) {
                return `
ğŸ“‹ ${student.name} í•™ìƒ ìˆ™ì œ (${date})
${student.school} ${student.grade}

ğŸ“ ì–´íœ˜ì‹œí—˜
â€¢ ì˜¤ëŠ˜ ìˆ™ì œ: ${homework.vocabularyTest || 'ì—†ìŒ'}

ğŸ”¤ ì†Œë¦¬í›ˆë ¨
â€¢ ì˜¤ëŠ˜ ìˆ™ì œ: ${homework.phonics || 'ì—†ìŒ'}
â€¢ ë‹¤ìŒ ì§„ë„: ${homework.phonicsProgress || 'ì—†ìŒ'}

ğŸ“š ì›ì„œìˆ˜ì—… & ë¬¸ë²•
â€¢ ì›ì„œìˆ˜ì—…: ${homework.reading || 'ì—†ìŒ'}
â€¢ ë¬¸ë²• ìˆ™ì œ: ${homework.grammar || 'ì—†ìŒ'}

ğŸ“Š í‰ê°€ ê²°ê³¼
â€¢ ì–´íœ˜í•©ê²©: ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
â€¢ ì†Œë¦¬í›ˆë ¨: ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
â€¢ ë¬¸ë²•ìˆ™ì œ: ${homework.grammarComplete ? 'âœ… ì™„ë£Œ' : 'âŒ ë¯¸ì™„ë£Œ'}
â€¢ í€´ì¦ë¦¿: ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}

ğŸ’¬ í”¼ë“œë°±
${homework.feedback || 'ì—†ìŒ'}

---
ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}
í•™ìƒ ìˆ™ì œ ê´€ë¦¬ ì‹œìŠ¤í…œ
                `.trim();
            } else {
                return `
ğŸ“‹ ${student.name} í•™ìƒ ìˆ™ì œ (${date})
${student.school} ${student.grade}

ğŸ“š ì–´íœ˜ (ì…ì²´ì–´íœ˜ 4000)
â€¢ ì˜¤ëŠ˜ ìˆ™ì œ: ${formatVocabularyText(homework.vocabulary) || 'ì—†ìŒ'}
â€¢ ì§„ë„ìœ¨: ${calculateVocabularyProgress(student.id)}%

ğŸ”¤ ì†Œë¦¬í›ˆë ¨
â€¢ ì˜¤ëŠ˜ ìˆ™ì œ: ${homework.phonics || 'ì—†ìŒ'}
â€¢ ë‹¤ìŒ ì§„ë„: ${homework.phonicsProgress || 'ì—†ìŒ'}

ğŸ“– ë…ì„œ & ê¸°íƒ€
â€¢ ë…ì„œ ìˆ™ì œ: ${homework.reading || 'ì—†ìŒ'}
â€¢ í€´ì¦ë¦¿ í•™ìŠµ: ${homework.quizletEnabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}${homework.quizletUrl ? `\nâ€¢ í€´ì¦ë¦¿ URL: ${homework.quizletUrl}` : ''}
${homework.prepareQuizlet ? 'â€¢ "í€´ì¦ë¦¿ ì‹œí—˜ì„ ì¤€ë¹„í•˜ì„¸ìš”"' : ''}
â€¢ ê¸°íƒ€ ìˆ™ì œ: ${homework.other || 'ì—†ìŒ'}

ğŸ“Š í‰ê°€ ê²°ê³¼
â€¢ ì…ì²´ì–´íœ˜: ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
â€¢ ì†Œë¦¬í›ˆë ¨: ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
â€¢ í€´ì¦ë¦¿: ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}

ğŸ’¬ í”¼ë“œë°±
${homework.feedback || 'ì—†ìŒ'}

---
ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}
í•™ìƒ ìˆ™ì œ ê´€ë¦¬ ì‹œìŠ¤í…œ
                `.trim();
            }
        }

        // ì¸ì‡„ìš© HTML í¬ë§·íŒ…
        function formatHomeworkForPrint(student, homework, progress) {
            const date = new Date(currentDate).toLocaleDateString('ko-KR');
            
            const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
            const isSpecialClass = specialClasses.includes(student.class);
            
            if (isSpecialClass) {
                return `
                    <div class="header">
                        <h1>ğŸ“‹ í•™ìƒ ìˆ™ì œ</h1>
                        <h2>${student.name}</h2>
                        <p>${date}</p>
                    </div>
                    
                    <div class="student-info">
                        <strong>í•™ìƒ ì •ë³´:</strong> ${student.school} ${student.grade}
                    </div>
                    
                    <div class="homework-section">
                        <div class="homework-item">
                            <div class="homework-title">ğŸ“ ì–´íœ˜ì‹œí—˜</div>
                            <div class="homework-content">
                                <p><strong>ì˜¤ëŠ˜ ìˆ™ì œ:</strong> ${homework.vocabularyTest || 'ì—†ìŒ'}</p>
                            </div>
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-title">ğŸ”¤ ì†Œë¦¬í›ˆë ¨</div>
                            <div class="homework-content">
                                <p><strong>ì˜¤ëŠ˜ ìˆ™ì œ:</strong> ${homework.phonics || 'ì—†ìŒ'}</p>
                                <p><strong>ë‹¤ìŒ ì§„ë„:</strong> ${homework.phonicsProgress || 'ì—†ìŒ'}</p>
                            </div>
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-title">ğŸ“š ì›ì„œìˆ˜ì—… & ë¬¸ë²•</div>
                            <div class="homework-content">
                                <p><strong>ì›ì„œìˆ˜ì—…:</strong> ${homework.reading || 'ì—†ìŒ'}</p>
                                <p><strong>ë¬¸ë²• ìˆ™ì œ:</strong> ${homework.grammar || 'ì—†ìŒ'}</p>
                            </div>
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-title">ğŸ“Š í‰ê°€ ê²°ê³¼</div>
                            <div class="homework-content">
                                <p><strong>ì–´íœ˜í•©ê²©:</strong> 
                                    <span style="color: ${homework.vocabularyPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                        ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                                    </span>
                                </p>
                                <p><strong>ì†Œë¦¬í›ˆë ¨:</strong> 
                                    <span style="color: ${homework.phonicsPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                        ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                                    </span>
                                </p>
                                <p><strong>ë¬¸ë²•ìˆ™ì œ:</strong> 
                                    <span style="color: ${homework.grammarComplete ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                        ${homework.grammarComplete ? 'âœ… ì™„ë£Œ' : 'âŒ ë¯¸ì™„ë£Œ'}
                                    </span>
                                </p>
                                <p><strong>í€´ì¦ë¦¿:</strong> 
                                    <span style="color: ${homework.quizletPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                        ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                                    </span>
                                </p>
                            </div>
                        </div>
                        
                        ${homework.feedback ? `
                        <div class="homework-item">
                            <div class="homework-title">ğŸ’¬ í”¼ë“œë°±</div>
                            <div class="homework-content">
                                <p style="white-space: pre-wrap; line-height: 1.6;">${homework.feedback}</p>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            } else {
                return `
                    <div class="header">
                        <h1>ğŸ“‹ í•™ìƒ ìˆ™ì œ</h1>
                        <h2>${student.name}</h2>
                        <p>${date}</p>
                    </div>
                    
                    <div class="student-info">
                        <strong>í•™ìƒ ì •ë³´:</strong> ${student.school} ${student.grade}
                    </div>
                    
                    <div class="homework-section">
                        <div class="homework-item">
                            <div class="homework-title">ğŸ“š ì–´íœ˜ (ì…ì²´ì–´íœ˜ 4000)</div>
                            <div class="homework-content">
                                <p><strong>ì˜¤ëŠ˜ ìˆ™ì œ:</strong> ${formatVocabularyText(homework.vocabulary) || 'ì—†ìŒ'}</p>
                                <div class="progress-info">
                                    <strong>ì§„ë„ìœ¨:</strong> ${calculateVocabularyProgress(student.id)}%
                                </div>
                            </div>
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-title">ğŸ”¤ ì†Œë¦¬í›ˆë ¨</div>
                            <div class="homework-content">
                                <p><strong>ì˜¤ëŠ˜ ìˆ™ì œ:</strong> ${homework.phonics || 'ì—†ìŒ'}</p>
                                <p><strong>ë‹¤ìŒ ì§„ë„:</strong> ${homework.phonicsProgress || 'ì—†ìŒ'}</p>
                            </div>
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-title">ğŸ“– ë…ì„œ & ê¸°íƒ€</div>
                            <div class="homework-content">
                                <p><strong>ë…ì„œ ìˆ™ì œ:</strong> ${homework.reading || 'ì—†ìŒ'}</p>
                                <p><strong>í€´ì¦ë¦¿ í•™ìŠµ:</strong> ${homework.quizletEnabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}</p>
                                ${homework.quizletUrl ? `<p><strong>í€´ì¦ë¦¿ URL:</strong> ${homework.quizletUrl}</p>` : ''}
                                ${homework.prepareQuizlet ? `<p><strong>ì•ˆë‚´:</strong> "í€´ì¦ë¦¿ ì‹œí—˜ì„ ì¤€ë¹„í•˜ì„¸ìš”"</p>` : ''}
                                <p><strong>ê¸°íƒ€ ìˆ™ì œ:</strong> ${homework.other || 'ì—†ìŒ'}</p>
                            </div>
                        </div>
                        
                        <div class="homework-item">
                            <div class="homework-title">ğŸ“Š í‰ê°€ ê²°ê³¼</div>
                            <div class="homework-content">
                                <p><strong>ì…ì²´ì–´íœ˜:</strong> 
                                    <span style="color: ${homework.vocabularyPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                        ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                                    </span>
                                </p>
                                <p><strong>ì†Œë¦¬í›ˆë ¨:</strong> 
                                    <span style="color: ${homework.phonicsPass ? '#52c41a' : 'âŒ ë¶ˆí•©ê²©'}; font-weight: 600;">
                                        ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                                    </span>
                                </p>
                                <p><strong>í€´ì¦ë¦¿:</strong> 
                                    <span style="color: ${homework.quizletPass ? '#52c41a' : '#f5222d'}; font-weight: 600;">
                                        ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}
                                    </span>
                                </p>
                            </div>
                        </div>
                        
                        ${homework.feedback ? `
                        <div class="homework-item">
                            <div class="homework-title">ğŸ’¬ í”¼ë“œë°±</div>
                            <div class="homework-content">
                                <p style="white-space: pre-wrap; line-height: 1.6;">${homework.feedback}</p>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
        }

        // ì „ì²´ ë°˜ë³„ ìˆ™ì œ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ ì¶”ê°€
        function exportClassHomework() {
            const classFilter = document.getElementById('class-filter').value;
            let students = studentsData;
            
            if (classFilter !== 'all') {
                students = studentsData.filter(student => student.class === classFilter);
            }
            
            let allHomeworkText = `ğŸ“‹ ${classFilter === 'all' ? 'ì „ì²´' : classFilter}ë°˜ ìˆ™ì œ ëª©ë¡\n`;
            allHomeworkText += `ë‚ ì§œ: ${new Date(currentDate).toLocaleDateString('ko-KR')}\n`;
            allHomeworkText += `ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}\n`;
            allHomeworkText += `${'='.repeat(50)}\n\n`;
            
            students.forEach((student, index) => {
                const homework = getHomeworkForStudent(student.id);
                const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
                const isSpecialClass = specialClasses.includes(student.class);
                
                allHomeworkText += `${index + 1}. ${student.name} (${student.school} ${student.grade})\n`;
                
                if (isSpecialClass) {
                    allHomeworkText += `   ğŸ“ ì–´íœ˜ì‹œí—˜: ${homework.vocabularyTest || 'ì—†ìŒ'}\n`;
                    allHomeworkText += `   ğŸ”¤ ì†Œë¦¬: ${homework.phonics || 'ì—†ìŒ'}\n`;
                    if (homework.phonicsProgress) {
                        allHomeworkText += `   ğŸ”¤ ë‹¤ìŒì§„ë„: ${homework.phonicsProgress}\n`;
                    }
                    allHomeworkText += `   ğŸ“š ì›ì„œìˆ˜ì—…: ${homework.reading || 'ì—†ìŒ'}\n`;
                    allHomeworkText += `   ğŸ“– ë¬¸ë²•: ${homework.grammar || 'ì—†ìŒ'}\n`;
                    allHomeworkText += `   ğŸ“Š ì–´íœ˜í•©ê²©: ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                    allHomeworkText += `   ğŸ“Š ì†Œë¦¬í›ˆë ¨: ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                    allHomeworkText += `   ğŸ“Š ë¬¸ë²•ìˆ™ì œ: ${homework.grammarComplete ? 'âœ… ì™„ë£Œ' : 'âŒ ë¯¸ì™„ë£Œ'}\n`;
                    allHomeworkText += `   ğŸ“Š í€´ì¦ë¦¿: ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                } else {
                    allHomeworkText += `   ğŸ“š ì–´íœ˜: ${formatVocabularyText(homework.vocabulary) || 'ì—†ìŒ'}\n`;
                    allHomeworkText += `   ğŸ”¤ ì†Œë¦¬: ${homework.phonics || 'ì—†ìŒ'}\n`;
                    if (homework.phonicsProgress) {
                        allHomeworkText += `   ğŸ”¤ ë‹¤ìŒì§„ë„: ${homework.phonicsProgress}\n`;
                    }
                    allHomeworkText += `   ğŸ“– ë…ì„œ: ${homework.reading || 'ì—†ìŒ'}\n`;
                    allHomeworkText += `   ğŸ“– ë¬¸ë²•: ${homework.grammar || 'ì—†ìŒ'}\n`;
                    if (homework.quizletEnabled && homework.quizletUrl) {
                        allHomeworkText += `   ğŸ¯ í€´ì¦ë¦¿: ${homework.quizletUrl}\n`;
                    }
                    allHomeworkText += `   âœï¸ ê¸°íƒ€: ${homework.other || 'ì—†ìŒ'}\n`;
                    allHomeworkText += `   ğŸ“Š ì…ì²´ì–´íœ˜: ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                    allHomeworkText += `   ğŸ“Š ì†Œë¦¬í›ˆë ¨: ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                    allHomeworkText += `   ğŸ“Š ë¬¸ë²•ìˆ™ì œ: ${homework.grammarComplete ? 'âœ… ì™„ë£Œ' : 'âŒ ë¯¸ì™„ë£Œ'}\n`;
                    allHomeworkText += `   ğŸ“Š í€´ì¦ë¦¿: ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                }
                
                if (homework.feedback) {
                    allHomeworkText += `   ğŸ’¬ í”¼ë“œë°±: ${homework.feedback}\n`;
                }
                allHomeworkText += `\n`;
            });
            
            navigator.clipboard.writeText(allHomeworkText).then(() => {
                showNotification(`${classFilter === 'all' ? 'ì „ì²´' : classFilter}ë°˜ ìˆ™ì œ ëª©ë¡ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        // ì¼ê´„ ì‘ì—…ì—ì„œ ì„ íƒí•œ ë°˜ì˜ ìˆ™ì œ ë³µì‚¬
        function copyBulkHomework() {
            const className = document.getElementById('bulk-class').value;
            
            if (!className) {
                showNotification('ë³µì‚¬í•  ë°˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            const studentsInClass = studentsData.filter(student => student.class === className);
            const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
            const isSpecialClass = specialClasses.includes(className);
            
            let classHomeworkText = `ğŸ“‹ ${className}ë°˜ ìˆ™ì œ ëª©ë¡\n`;
            classHomeworkText += `ë‚ ì§œ: ${new Date(currentDate).toLocaleDateString('ko-KR')}\n`;
            classHomeworkText += `ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}\n`;
            classHomeworkText += `${'='.repeat(50)}\n\n`;
            
            studentsInClass.forEach((student, index) => {
                const homework = getHomeworkForStudent(student.id);
                
                classHomeworkText += `${index + 1}. ${student.name} (${student.school} ${student.grade})\n`;
                
                if (isSpecialClass) {
                    classHomeworkText += `   ğŸ“ ì–´íœ˜ì‹œí—˜: ${homework.vocabularyTest || 'ì—†ìŒ'}\n`;
                    classHomeworkText += `   ğŸ”¤ ì†Œë¦¬: ${homework.phonics || 'ì—†ìŒ'}\n`;
                    if (homework.phonicsProgress) {
                        classHomeworkText += `   ğŸ”¤ ë‹¤ìŒì§„ë„: ${homework.phonicsProgress}\n`;
                    }
                    classHomeworkText += `   ğŸ“š ì›ì„œìˆ˜ì—…: ${homework.reading || 'ì—†ìŒ'}\n`;
                    classHomeworkText += `   ğŸ“– ë¬¸ë²•: ${homework.grammar || 'ì—†ìŒ'}\n`;
                    classHomeworkText += `   ğŸ“Š ì–´íœ˜í•©ê²©: ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                    classHomeworkText += `   ğŸ“Š ì†Œë¦¬í›ˆë ¨: ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                    classHomeworkText += `   ğŸ“Š ë¬¸ë²•ìˆ™ì œ: ${homework.grammarComplete ? 'âœ… ì™„ë£Œ' : 'âŒ ë¯¸ì™„ë£Œ'}\n`;
                    classHomeworkText += `   ğŸ“Š í€´ì¦ë¦¿: ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                } else {
                    classHomeworkText += `   ğŸ“š ì–´íœ˜: ${formatVocabularyText(homework.vocabulary) || 'ì—†ìŒ'}\n`;
                    classHomeworkText += `   ğŸ”¤ ì†Œë¦¬: ${homework.phonics || 'ì—†ìŒ'}\n`;
                    if (homework.phonicsProgress) {
                        classHomeworkText += `   ğŸ”¤ ë‹¤ìŒì§„ë„: ${homework.phonicsProgress}\n`;
                    }
                    classHomeworkText += `   ğŸ“– ë…ì„œ: ${homework.reading || 'ì—†ìŒ'}\n`;
                    classHomeworkText += `   ğŸ“– ë¬¸ë²•: ${homework.grammar || 'ì—†ìŒ'}\n`;
                    if (homework.quizletEnabled && homework.quizletUrl) {
                        classHomeworkText += `   ğŸ¯ í€´ì¦ë¦¿: ${homework.quizletUrl}\n`;
                    }
                    classHomeworkText += `   âœï¸ ê¸°íƒ€: ${homework.other || 'ì—†ìŒ'}\n`;
                    classHomeworkText += `   ğŸ“Š ì…ì²´ì–´íœ˜: ${homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                    classHomeworkText += `   ğŸ“Š ì†Œë¦¬í›ˆë ¨: ${homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                    classHomeworkText += `   ğŸ“Š ë¬¸ë²•ìˆ™ì œ: ${homework.grammarComplete ? 'âœ… ì™„ë£Œ' : 'âŒ ë¯¸ì™„ë£Œ'}\n`;
                    classHomeworkText += `   ğŸ“Š í€´ì¦ë¦¿: ${homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¶ˆí•©ê²©'}\n`;
                }
                
                if (homework.feedback) {
                    classHomeworkText += `   ğŸ’¬ í”¼ë“œë°±: ${homework.feedback}\n`;
                }
                classHomeworkText += `\n`;
            });
            
            navigator.clipboard.writeText(classHomeworkText).then(() => {
                showNotification(`${className}ë°˜ ìˆ™ì œ ëª©ë¡ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        function toggleClass(className) {
            const studentsGrid = document.getElementById(`students-${className}`);
            const toggleBtn = document.getElementById(`toggle-${className}`);
            
            if (studentsGrid.classList.contains('expanded')) {
                studentsGrid.classList.remove('expanded');
                toggleBtn.textContent = 'â–¼';
                toggleBtn.classList.remove('collapsed');
            } else {
                studentsGrid.classList.add('expanded');
                toggleBtn.textContent = 'â–²';
                toggleBtn.classList.add('collapsed');
            }
        }

        function getHomeworkForStudent(studentId) {
            const dateKey = currentDate;
            if (!homeworkData[dateKey]) {
                homeworkData[dateKey] = {};
            }
            if (!homeworkData[dateKey][studentId]) {
                homeworkData[dateKey][studentId] = {
                    vocabulary: '',
                    vocabularyTest: '',
                    phonics: '',
                    phonicsProgress: '',
                    reading: '',
                    other: '',
                    grammar: '',
                    quizletEnabled: true,
                    quizletUrl: '',
                    vocabularyPass: true,
                    phonicsPass: true,
                    quizletPass: true,
                    prepareQuizlet: true,
                    grammarComplete: false,
                    feedback: ''
                };
            }
            return homeworkData[dateKey][studentId];
        }

        function updateHomework(studentId, category, value) {
            const dateKey = currentDate;
            if (!homeworkData[dateKey]) {
                homeworkData[dateKey] = {};
            }
            if (!homeworkData[dateKey][studentId]) {
                homeworkData[dateKey][studentId] = {};
            }
            
            homeworkData[dateKey][studentId][category] = value;

            // ë…ì„œì™€ ë¬¸ë²•ìˆ™ì œëŠ” ë°˜ ì „ì²´ ê³µí†µ ì ìš©
            if (category === 'reading' || category === 'grammar') {
                const student = studentsData.find(s => s.id === studentId);
                if (student) {
                    const studentsInClass = studentsData.filter(s => s.class === student.class);
                    studentsInClass.forEach(s => {
                        if (!homeworkData[dateKey][s.id]) {
                            homeworkData[dateKey][s.id] = {};
                        }
                        homeworkData[dateKey][s.id][category] = value;
                    });
                    saveHomeworkData();
                    renderStudents();
                }
            }
            
            // í€´ì¦ë¦¿ ìƒíƒœ ë³€ê²½ ì‹œ UI ì—…ë°ì´íŠ¸
            if (category === 'quizletEnabled') {
                renderStudents();
            }
            
            updateStats();
        }

        function saveStudentHomework(studentId) {
            saveHomeworkData();
            showNotification('í•™ìƒ ìˆ™ì œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        function applyBulkHomework() {
            const className = document.getElementById('bulk-class').value;
            const category = document.getElementById('bulk-category').value;
            const homework = document.getElementById('bulk-homework').value;
            
            if (!className || !category || !homework) {
                showNotification('ëª¨ë“  í•„ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            const studentsInClass = studentsData.filter(student => student.class === className);
            
            studentsInClass.forEach(student => {
                if (category === 'quizletEnabled') {
                    updateHomework(student.id, category, homework === 'true');
                } else {
                    updateHomework(student.id, category, homework);
                }
            });
            
            renderStudents();
            saveHomeworkData();
            showNotification(`${className} ë°˜ ${studentsInClass.length}ëª…ì—ê²Œ ${category} ìˆ™ì œê°€ ì¼ê´„ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        function onDateChange() {
            currentDate = document.getElementById('homework-date').value;
            renderStudents();
            updateStats();
        }

        function onClassFilterChange() {
            renderStudents();
            updateStats();
        }

        function updateStats() {
            const classFilter = document.getElementById('class-filter').value;
            let students = studentsData;
            
            if (classFilter !== 'all') {
                students = studentsData.filter(student => student.class === classFilter);
            }
            
            const totalStudents = students.length;
            let completedHomework = 0;
            
            students.forEach(student => {
                const homework = getHomeworkForStudent(student.id);
                const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
                const isSpecialClass = specialClasses.includes(student.class);
                
                if (isSpecialClass) {
                    if (homework.vocabularyTest || homework.phonics || homework.reading || homework.grammar) {
                        completedHomework++;
                    }
                } else {
                    if (homework.vocabulary || homework.phonics || homework.reading || homework.other) {
                        completedHomework++;
                    }
                }
            });
            
            const completionRate = totalStudents > 0 ? Math.round((completedHomework / totalStudents) * 100) : 0;
            
            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('completed-homework').textContent = completedHomework;
            document.getElementById('completion-rate').textContent = completionRate + '%';
        }

        function saveHomeworkData() {
            try {
                localStorage.setItem('homework-data', JSON.stringify(homeworkData));
            } catch (error) {
                console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
                showNotification('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function loadHomeworkData() {
            try {
                const savedData = localStorage.getItem('homework-data');
                if (savedData) {
                    homeworkData = JSON.parse(savedData);
                }
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                homeworkData = {};
            }
        }

        function saveStudentProgress() {
            try {
                localStorage.setItem('student-progress', JSON.stringify(studentProgress));
            } catch (error) {
                console.error('ì§„ë„ ì €ì¥ ì‹¤íŒ¨:', error);
                showNotification('ì§„ë„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function loadStudentProgress() {
            try {
                const savedProgress = localStorage.getItem('student-progress');
                if (savedProgress) {
                    studentProgress = JSON.parse(savedProgress);
                }
            } catch (error) {
                console.error('ì§„ë„ ë¡œë“œ ì‹¤íŒ¨:', error);
                studentProgress = {};
            }
        }

        function exportHomework() {
            const dateKey = currentDate;
            const data = homeworkData[dateKey] || {};
            
            let csvContent = 'data:text/csv;charset=utf-8,';
            csvContent += 'ë°˜,í•™ìƒëª…,í•™êµ,í•™ë…„,ì–´íœ˜/ì–´íœ˜ì‹œí—˜,ì†Œë¦¬,ì†Œë¦¬ì§„ë„,ë…ì„œ/ì›ì„œìˆ˜ì—…,í€´ì¦ë¦¿í™œì„±í™”,í€´ì¦ë¦¿URL,ê¸°íƒ€/ë¬¸ë²•,ì–´íœ˜í‰ê°€,ì†Œë¦¬í›ˆë ¨í‰ê°€,í€´ì¦ë¦¿í‰ê°€,ë¬¸ë²•ì™„ë£Œ,í”¼ë“œë°±,ì–´íœ˜ì§„ë„,ìµœì¢…ì™„ë£Œ\n';
            
            studentsData.forEach(student => {
                const homework = data[student.id] || {};
                const progress = getStudentProgress(student.id);
                const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
                const isSpecialClass = specialClasses.includes(student.class);
                
                const row = [
                    student.class,
                    student.name,
                    student.school,
                    student.grade,
                    isSpecialClass ? (homework.vocabularyTest || '') : (formatVocabularyText(homework.vocabulary) || ''),
                    homework.phonics || '',
                    homework.phonicsProgress || '',
                    homework.reading || '',
                    homework.quizletEnabled ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤',
                    homework.quizletUrl || '',
                    isSpecialClass ? (homework.grammar || '') : (homework.other || ''),
                    homework.vocabularyPass ? 'í•©ê²©' : 'ë¶ˆí•©ê²©',
                    homework.phonicsPass ? 'í•©ê²©' : 'ë¶ˆí•©ê²©',
                    homework.quizletPass ? 'í•©ê²©' : 'ë¶ˆí•©ê²©',
                    homework.grammarComplete ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ',
                    homework.feedback || '',
                    `Unit ${progress.vocabulary.currentUnit} - ${progress.vocabulary.currentStage}ì°¨`,
                    homework.finalized ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'
                ].map(field => `"${field}"`).join(',');
                
                csvContent += row + '\n';
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', `homework_${currentDate}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ìˆ™ì œ ë°ì´í„°ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!', 'success');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ìë™ ì €ì¥ ê¸°ëŠ¥
        setInterval(() => {
            saveHomeworkData();
            saveStudentProgress();
        }, 30000); // 30ì´ˆë§ˆë‹¤ ìë™ ì €ì¥

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ê¸°ëŠ¥
        document.addEventListener('keydown', function(event) {
            // Ctrl+S: ì „ì²´ ì €ì¥
            if (event.ctrlKey && event.key === 's') {
                event.preventDefault();
                saveHomeworkData();
                saveStudentProgress();
                showNotification('ëª¨ë“  ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }
            
            // Ctrl+E: í˜„ì¬ í™”ë©´ ë‚´ë³´ë‚´ê¸°
            if (event.ctrlKey && event.key === 'e') {
                event.preventDefault();
                exportClassHomework();
            }
            
            // ESC: ëª¨ë“  ëª¨ë‹¬ ë‹«ê¸°
            if (event.key === 'Escape') {
                closeProgressModal();
                closeSummaryModal();
            }
        });

        // ì‹œìŠ¤í…œ ê°€ì´ë“œ í‘œì‹œ
        function showSystemGuide() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; width: 700px; max-width: 90%; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation();">
                    <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“š ì‹œìŠ¤í…œ ì‚¬ìš© ê°€ì´ë“œ</h2>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #1890ff;">ğŸ¯ ì£¼ìš” ê¸°ëŠ¥</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>ê°œë³„ í•™ìƒ ê´€ë¦¬:</strong> ê° í•™ìƒë³„ë¡œ ì–´íœ˜, ì†Œë¦¬, ë…ì„œ, ê¸°íƒ€ ìˆ™ì œ ì„¤ì •</li>
                            <li><strong>íŠ¹ë³„ë°˜ ê´€ë¦¬:</strong> ê°€ë‹ˆë©”ë°, ìœ ë¡œíŒŒ A/B, íƒ€ì´íƒ„ A/B ë°˜ì€ ì–´íœ˜ì‹œí—˜, ì›ì„œìˆ˜ì—…, ë¬¸ë²• í˜•íƒœ</li>
                            <li><strong>ì§„ë„ ì¶”ì :</strong> ì…ì²´ì–´íœ˜ 4000 ì§„ë„ ìë™ ê´€ë¦¬</li>
                            <li><strong>ì†Œë¦¬í›ˆë ¨:</strong> 22ê°œ í”„ë¡œê·¸ë¨ ì¤‘ ì„ íƒ ë° ì§„ë„ ê¸°ë¡</li>
                            <li><strong>í‰ê°€ ì‹œìŠ¤í…œ:</strong> ì–´íœ˜í•©ê²©, ì†Œë¦¬í›ˆë ¨ í•©ê²©, ë¬¸ë²•ìˆ™ì œ ì™„ë£Œ ì²´í¬</li>
                            <li><strong>ì¼ê´„ ì‘ì—…:</strong> ë°˜ë³„ë¡œ ê°™ì€ ìˆ™ì œ ì¼ê´„ ì ìš©</li>
                            <li><strong>ë³µì‚¬/ì¸ì‡„:</strong> í•™ìƒë³„ ë˜ëŠ” ë°˜ë³„ ìˆ™ì œ ë³µì‚¬ ë° ì¸ì‡„</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #fa8c16;">âŒ¨ï¸ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>Ctrl + S:</strong> ì „ì²´ ë°ì´í„° ì €ì¥</li>
                            <li><strong>Ctrl + E:</strong> í˜„ì¬ í™”ë©´ ë‚´ë³´ë‚´ê¸°</li>
                            <li><strong>ESC:</strong> ëª¨ë“  ëª¨ë‹¬ ë‹«ê¸°</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #52c41a;">ğŸ“‹ íŠ¹ë³„ë°˜ ê¸°ëŠ¥</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>ì–´íœ˜ì‹œí—˜:</strong> ì…ì²´ì–´íœ˜ 4000 ëŒ€ì‹  ì§ì ‘ ì§„ë„ ì…ë ¥</li>
                            <li><strong>ì›ì„œìˆ˜ì—…:</strong> ë…ì„œ ëŒ€ì‹  ì›ì„œìˆ˜ì—… ë‚´ìš© ì…ë ¥</li>
                            <li><strong>ë¬¸ë²•:</strong> ê¸°íƒ€ ëŒ€ì‹  ë¬¸ë²• ìˆ™ì œ ì…ë ¥</li>
                            <li><strong>í€´ì¦ë¦¿ ì œê±°:</strong> íŠ¹ë³„ë°˜ì—ì„œëŠ” í€´ì¦ë¦¿ ê¸°ëŠ¥ ì—†ìŒ</li>
                            <li><strong>3ê°€ì§€ í‰ê°€:</strong> ì–´íœ˜í•©ê²©, ì†Œë¦¬í›ˆë ¨ í•©ê²©, ë¬¸ë²•ìˆ™ì œ ì™„ë£Œ</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #722ed1;">ğŸ’¡ ì‚¬ìš© íŒ</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>30ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ ë°ì´í„°ê°€ ì €ì¥ë©ë‹ˆë‹¤</li>
                            <li>ë°˜ë³„ë¡œ ë‹¤ë¥¸ UIê°€ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤</li>
                            <li>ì²´í¬ë°•ìŠ¤ ë°©ì‹ìœ¼ë¡œ ê°„í¸í•˜ê²Œ í‰ê°€ ê²°ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”</li>
                            <li>ë³µì‚¬ ê¸°ëŠ¥ìœ¼ë¡œ í•™ë¶€ëª¨ë‚˜ í•™ìƒì—ê²Œ ìˆ™ì œë¥¼ ì‰½ê²Œ ì „ë‹¬í•˜ì„¸ìš”</li>
                            <li>íŠ¹ë³„ë°˜ê³¼ ì¼ë°˜ë°˜ì˜ ì¶œë ¥ í˜•ì‹ì´ ìë™ìœ¼ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤</li>
                        </ul>
                    </div>
                    
                    <button onclick="closeSystemGuide()" style="width: 100%; padding: 12px; background: #1890ff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-top: 20px;">
                        âœ… í™•ì¸
                    </button>
                </div>
            `;
            
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeSystemGuide();
                }
            };
            
            document.body.appendChild(modal);
            window.currentGuideModal = modal;
        }

        function closeSystemGuide() {
            if (window.currentGuideModal) {
                document.body.removeChild(window.currentGuideModal);
                window.currentGuideModal = null;
            }
        }

        // ë°ì´í„° ë°±ì—… ê¸°ëŠ¥
        function backupData() {
            const backupData = {
                homeworkData: homeworkData,
                studentProgress: studentProgress,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `homework_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ë°ì´í„° ë°±ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }

        // ë°ì´í„° ë³µêµ¬ ê¸°ëŠ¥
        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // ë°±ì—… ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                    if (!backupData.homeworkData || !backupData.studentProgress) {
                        showNotification('ì˜ëª»ëœ ë°±ì—… íŒŒì¼ì…ë‹ˆë‹¤.', 'error');
                        return;
                    }
                    
                    // í™•ì¸ ëŒ€í™”ìƒì
                    if (confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ë°±ì—… ë°ì´í„°ë¡œ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?\n\në°±ì—… ë‚ ì§œ: ' + new Date(backupData.exportDate).toLocaleString('ko-KR'))) {
                        homeworkData = backupData.homeworkData;
                        studentProgress = backupData.studentProgress;
                        
                        saveHomeworkData();
                        saveStudentProgress();
                        
                        renderStudents();
                        updateStats();
                        
                        showNotification('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    }
                } catch (error) {
                    console.error('ë³µêµ¬ ì‹¤íŒ¨:', error);
                    showNotification('ë°ì´í„° ë³µêµ¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            };
            reader.readAsText(file);
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }

        // ë°ì´í„° ì´ˆê¸°í™” ê¸°ëŠ¥ (ì„ íƒì‚¬í•­)
        function clearAllData() {
            if (confirm('âš ï¸ ê²½ê³ : ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.\n\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
                    localStorage.removeItem('homework-data');
                    localStorage.removeItem('student-progress');
                    homeworkData = {};
                    studentProgress = {};
                    renderStudents();
                    updateStats();
                    showNotification('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                }
            }
        }

        // í•™ìƒ ê´€ë¦¬ ê¸°ëŠ¥
        function showStudentManagement() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center; overflow-y: auto;
            `;
            
            const studentsList = studentsData.map(s => `
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">${s.id}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${s.name}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${s.class}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${s.school}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${s.grade}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">
                        <button onclick="editStudent(${s.id})" style="padding: 4px 8px; margin: 0 2px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer;">âœï¸ ìˆ˜ì •</button>
                        <button onclick="deleteStudent(${s.id})" style="padding: 4px 8px; margin: 0 2px; background: #f5222d; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ—‘ï¸ ì‚­ì œ</button>
                    </td>
                </tr>
            `).join('');
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 1000px; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation();">
                    <h2 style="text-align: center; margin-bottom: 20px;">ğŸ‘¥ í•™ìƒ ê´€ë¦¬</h2>
                    
                    <button onclick="showAddStudentForm()" style="width: 100%; padding: 12px; background: #52c41a; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-bottom: 20px;">
                        â• ìƒˆ í•™ìƒ ì¶”ê°€
                    </button>
                    
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <thead>
                                <tr style="background: #f0f0f0;">
                                    <th style="padding: 10px; border: 1px solid #ddd;">ID</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">ì´ë¦„</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">ë°˜</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">í•™êµ</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">í•™ë…„</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${studentsList}
                            </tbody>
                        </table>
                    </div>
                    
                    <button onclick="closeStudentManagement()" style="width: 100%; padding: 12px; background: #d9d9d9; color: black; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                        âœ–ï¸ ë‹«ê¸°
                    </button>
                </div>
            `;
            
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeStudentManagement();
                }
            };
            
            document.body.appendChild(modal);
            window.currentStudentModal = modal;
        }

        function closeStudentManagement() {
            if (window.currentStudentModal) {
                document.body.removeChild(window.currentStudentModal);
                window.currentStudentModal = null;
            }
        }

        function showAddStudentForm() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1001; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            const newId = Math.max(...studentsData.map(s => s.id)) + 1;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; width: 500px; max-width: 90%;" onclick="event.stopPropagation();">
                    <h3 style="margin-bottom: 20px;">â• ìƒˆ í•™ìƒ ì¶”ê°€</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì´ë¦„ *</label>
                        <input type="text" id="new-student-name" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">ë°˜ *</label>
                        <input type="text" id="new-student-class" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;" placeholder="ì˜ˆ: ì¹¼ë¦¬ìŠ¤í†  A">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">í•™êµ</label>
                        <input type="text" id="new-student-school" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">í•™ë…„</label>
                        <input type="text" id="new-student-grade" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;" placeholder="ì˜ˆ: ì´ˆ5">
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="addStudent(${newId})" style="flex: 1; padding: 12px; background: #52c41a; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            âœ… ì¶”ê°€
                        </button>
                        <button onclick="closeAddStudentForm()" style="flex: 1; padding: 12px; background: #d9d9d9; color: black; border: none; border-radius: 8px; cursor: pointer;">
                            âœ–ï¸ ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            `;
            
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeAddStudentForm();
                }
            };
            
            document.body.appendChild(modal);
            window.currentAddModal = modal;
        }

        function closeAddStudentForm() {
            if (window.currentAddModal) {
                document.body.removeChild(window.currentAddModal);
                window.currentAddModal = null;
            }
        }

        function addStudent(id) {
            const name = document.getElementById('new-student-name').value.trim();
            const className = document.getElementById('new-student-class').value.trim();
            const school = document.getElementById('new-student-school').value.trim();
            const grade = document.getElementById('new-student-grade').value.trim();
            
            if (!name || !className) {
                alert('ì´ë¦„ê³¼ ë°˜ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            studentsData.push({ id, name, class: className, school, grade });
            saveStudentsData();
            
            closeAddStudentForm();
            closeStudentManagement();
            
            renderStudents();
            populateClassFilter();
            populateBulkOptions();
            updateStats();
            
            showNotification(`${name} í•™ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        function editStudent(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (!student) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1001; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; width: 500px; max-width: 90%;" onclick="event.stopPropagation();">
                    <h3 style="margin-bottom: 20px;">âœï¸ í•™ìƒ ì •ë³´ ìˆ˜ì •</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì´ë¦„ *</label>
                        <input type="text" id="edit-student-name" value="${student.name}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">ë°˜ *</label>
                        <input type="text" id="edit-student-class" value="${student.class}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">í•™êµ</label>
                        <input type="text" id="edit-student-school" value="${student.school}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">í•™ë…„</label>
                        <input type="text" id="edit-student-grade" value="${student.grade}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="saveEditStudent(${studentId})" style="flex: 1; padding: 12px; background: #1890ff; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            âœ… ì €ì¥
                        </button>
                        <button onclick="closeEditStudentForm()" style="flex: 1; padding: 12px; background: #d9d9d9; color: black; border: none; border-radius: 8px; cursor: pointer;">
                            âœ–ï¸ ì·¨ì†Œ
                        </button>
                    </div>
                </div>
            `;
            
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeEditStudentForm();
                }
            };
            
            document.body.appendChild(modal);
            window.currentEditModal = modal;
        }

        function closeEditStudentForm() {
            if (window.currentEditModal) {
                document.body.removeChild(window.currentEditModal);
                window.currentEditModal = null;
            }
        }

        function saveEditStudent(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (!student) return;
            
            const name = document.getElementById('edit-student-name').value.trim();
            const className = document.getElementById('edit-student-class').value.trim();
            const school = document.getElementById('edit-student-school').value.trim();
            const grade = document.getElementById('edit-student-grade').value.trim();
            
            if (!name || !className) {
                alert('ì´ë¦„ê³¼ ë°˜ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            student.name = name;
            student.class = className;
            student.school = school;
            student.grade = grade;
            
            saveStudentsData();
            
            closeEditStudentForm();
            closeStudentManagement();
            
            renderStudents();
            populateClassFilter();
            populateBulkOptions();
            updateStats();
            
            showNotification(`${name} í•™ìƒ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        function deleteStudent(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (!student) return;
            
            if (confirm(`${student.name} í•™ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œí•œ í•™ìƒì˜ ìˆ™ì œ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                studentsData = studentsData.filter(s => s.id !== studentId);
                saveStudentsData();
                
                closeStudentManagement();
                
                renderStudents();
                populateClassFilter();
                populateBulkOptions();
                updateStats();
                
                showNotification(`${student.name} í•™ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }

        function saveStudentsData() {
            try {
                localStorage.setItem('students-data', JSON.stringify(studentsData));
            } catch (error) {
                console.error('í•™ìƒ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        function loadStudentsData() {
            try {
                const savedData = localStorage.getItem('students-data');
                if (savedData) {
                    studentsData = JSON.parse(savedData);
                }
            } catch (error) {
                console.error('í•™ìƒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        // ë¶€ëª¨ë‹˜ í”¼ë“œë°± ìƒì„± ì‹œìŠ¤í…œ
        function generateParentFeedback(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            const homework = getHomeworkForStudent(studentId);
            const progress = getStudentProgress(studentId);
            const specialClasses = ['ê°€ë‹ˆë©”ë°', 'ìœ ë¡œíŒŒ A', 'ìœ ë¡œíŒŒ B', 'íƒ€ì´íƒ„ A', 'íƒ€ì´íƒ„ B'];
            const isSpecialClass = specialClasses.includes(student.class);

            // í˜„ì¬ ë‚ ì§œ í¬ë§·íŒ…
            const today = new Date();
            const dateStr = today.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            let feedback = `ğŸ“š ${student.name} í•™ìƒ ì˜¤ëŠ˜ì˜ í•™ìŠµ ê²°ê³¼ (${dateStr})\n\n`;
            feedback += `ì•ˆë…•í•˜ì„¸ìš”, ${student.name} í•™ìƒì˜ í•™ë¶€ëª¨ë‹˜! ì˜¤ëŠ˜ ${student.name} í•™ìƒì˜ ìˆ˜ì—… ì°¸ì—¬ì™€ ê³¼ì œ ìˆ˜í–‰ ê²°ê³¼ë¥¼ ë§ì”€ë“œë¦½ë‹ˆë‹¤.\n\n`;

            // ê¸°ë³¸ ì •ë³´
            feedback += `ğŸ‘¤ í•™ìƒ ì •ë³´\n`;
            feedback += `â€¢ ì´ë¦„: ${student.name}\n`;
            feedback += `â€¢ í•™êµ: ${student.school}\n`;
            feedback += `â€¢ í•™ë…„: ${student.grade}\n`;
            feedback += `â€¢ ë°˜: ${student.class}\n\n`;

            // í•™ìŠµ í™œë™ë³„ í”¼ë“œë°±
            feedback += `ğŸ“ ì˜¤ëŠ˜ì˜ í•™ìŠµ í™œë™\n`;

            if (isSpecialClass) {
                // íŠ¹ë³„ë°˜ í”¼ë“œë°±
                if (homework.vocabularyTest) {
                    const passStatus = homework.vocabularyPass ? 'âœ… í•©ê²©' : 'âŒ ë¯¸ë‹¬';
                    feedback += `â€¢ ì–´íœ˜ì‹œí—˜: ${homework.vocabularyTest} (${passStatus})\n`;
                    if (!homework.vocabularyPass) {
                        feedback += `  â†’ ì¶”ê°€ í•™ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤. ë³µìŠµì„ í†µí•´ ì‹¤ë ¥ì„ í‚¤ì›Œë³´ì„¸ìš”.\n`;
                    }
                }

                if (homework.phonics) {
                    const passStatus = homework.phonicsPass ? 'âœ… í•©ê²©' : 'âŒ ë¯¸ë‹¬';
                    feedback += `â€¢ ì†Œë¦¬ í›ˆë ¨: ${homework.phonics} (${passStatus})\n`;
                    if (homework.phonicsProgress) {
                        feedback += `  â†’ ë‹¤ìŒ ì§„ë„: ${homework.phonicsProgress}\n`;
                    }
                    if (!homework.phonicsPass) {
                        feedback += `  â†’ ë°œìŒ ì—°ìŠµì„ ë” í•˜ì‹œê¸¸ ê¶Œí•©ë‹ˆë‹¤.\n`;
                    }
                }

                if (homework.reading) {
                    feedback += `â€¢ ì›ì„œ ìˆ˜ì—…: ${homework.reading}\n`;
                    feedback += `  â†’ ë…ì„œë¥¼ í†µí•´ ì–´íœ˜ë ¥ê³¼ ë…í•´ë ¥ì´ í–¥ìƒë˜ê³  ìˆìŠµë‹ˆë‹¤.\n`;
                }

                if (homework.grammar) {
                    const completeStatus = homework.grammarComplete ? 'âœ… ì™„ë£Œ' : 'âŒ ë¯¸ì™„ë£Œ';
                    feedback += `â€¢ ë¬¸ë²• í•™ìŠµ: ${homework.grammar} (${completeStatus})\n`;
                    if (!homework.grammarComplete) {
                        feedback += `  â†’ ë¬¸ë²• ìˆ™ì œë¥¼ ì™„ë£Œí•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.\n`;
                    }
                }

                // í€´ì¦ë¦¿ ê´€ë ¨
                if (homework.quizletEnabled && homework.quizletUrl) {
                    const quizletStatus = homework.quizletPass ? 'âœ… í•©ê²©' : 'âŒ ë¯¸ë‹¬';
                    feedback += `â€¢ í€´ì¦ë¦¿ í•™ìŠµ: í™œì„±í™”ë¨ (${quizletStatus})\n`;
                    feedback += `  â†’ ë§í¬: ${homework.quizletUrl}\n`;
                    if (!homework.quizletPass) {
                        feedback += `  â†’ í€´ì¦ë¦¿ì„ í†µí•œ ì¶”ê°€ ë³µìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.\n`;
                    }
                }
            } else {
                // ì¼ë°˜ë°˜ í”¼ë“œë°±
                if (homework.vocabulary) {
                    feedback += `â€¢ ì–´íœ˜ í•™ìŠµ: ${homework.vocabulary}\n`;
                }

                if (homework.phonics) {
                    feedback += `â€¢ ì†Œë¦¬ í›ˆë ¨: ${homework.phonics}\n`;
                }

                if (homework.reading) {
                    feedback += `â€¢ ë…ì„œ/ì›ì„œ: ${homework.reading}\n`;
                }

                if (homework.other) {
                    feedback += `â€¢ ê¸°íƒ€ í™œë™: ${homework.other}\n`;
                }
            }

            // ì§„ë„ ì •ë³´
            if (progress && progress.vocabulary) {
                feedback += `\nğŸ“Š í˜„ì¬ ì§„ë„\n`;
                feedback += `â€¢ ì–´íœ˜ ì§„ë„: Unit ${progress.vocabulary.currentUnit} - Stage ${progress.vocabulary.currentStage}\n`;
            }

            // ì¢…í•© í‰ê°€ ë° ê¶Œì¥ì‚¬í•­
            feedback += `\nğŸ¯ ì¢…í•© í‰ê°€ ë° ê¶Œì¥ì‚¬í•­\n`;

            let completedTasks = 0;
            let totalTasks = 0;

            if (isSpecialClass) {
                if (homework.vocabularyTest) { totalTasks++; if (homework.vocabularyPass) completedTasks++; }
                if (homework.phonics) { totalTasks++; if (homework.phonicsPass) completedTasks++; }
                if (homework.reading) { totalTasks++; completedTasks++; }
                if (homework.grammar) { totalTasks++; if (homework.grammarComplete) completedTasks++; }
                if (homework.quizletEnabled) { totalTasks++; if (homework.quizletPass) completedTasks++; }
            } else {
                if (homework.vocabulary) { totalTasks++; completedTasks++; }
                if (homework.phonics) { totalTasks++; completedTasks++; }
                if (homework.reading) { totalTasks++; completedTasks++; }
                if (homework.other) { totalTasks++; completedTasks++; }
            }

            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 100;

            if (completionRate >= 90) {
                feedback += `â€¢ ğŸŒŸ ìš°ìˆ˜: ì˜¤ëŠ˜ ëª¨ë“  í•™ìŠµ í™œë™ì„ í›Œë¥­í•˜ê²Œ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤! (${completionRate}%)\n`;
                feedback += `â€¢ ì´ ì¡°ì¡°ë¡œ ê¾¸ì¤€íˆ í•™ìŠµí•˜ë©´ ì‹¤ë ¥ì´ í¬ê²Œ í–¥ìƒë  ê²ƒì…ë‹ˆë‹¤.\n`;
            } else if (completionRate >= 70) {
                feedback += `â€¢ ğŸ‘ ì–‘í˜¸: ëŒ€ë¶€ë¶„ì˜ í•™ìŠµ í™œë™ì„ ì˜ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤. (${completionRate}%)\n`;
                feedback += `â€¢ ì¡°ê¸ˆ ë” ì§‘ì¤‘í•˜ì—¬ ì™„ì„±ë„ë¥¼ ë†’ì—¬ë³´ì„¸ìš”.\n`;
            } else {
                feedback += `â€¢ ğŸ“¢ ê´€ì‹¬í•„ìš”: í•™ìŠµ ì°¸ì—¬ë„ê°€ ì•„ì‰½ìŠµë‹ˆë‹¤. (${completionRate}%)\n`;
                feedback += `â€¢ ì„ ìƒë‹˜ê³¼ ìƒë‹´ì„ í†µí•´ í•™ìŠµ ë°©ë²•ì„ ì ê²€í•´ë³´ì‹œê¸° ë°”ëë‹ˆë‹¤.\n`;
            }

            // ê°œì¸ë³„ í”¼ë“œë°±ì´ ìˆìœ¼ë©´ ì¶”ê°€
            if (homework.feedback && homework.feedback.trim()) {
                feedback += `\nğŸ’¬ ì„ ìƒë‹˜ ê°œë³„ í”¼ë“œë°±\n`;
                feedback += `${homework.feedback}\n`;
            }

            feedback += `\nğŸ“ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì—°ë½ì£¼ì„¸ìš”.\n`;
            feedback += `ê°ì‚¬í•©ë‹ˆë‹¤. ğŸ˜Š\n`;

            return feedback;
        }

        // ë¶€ëª¨ë‹˜ í”¼ë“œë°± í‘œì‹œ ëª¨ë‹¬
        function showParentFeedback(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            const feedback = generateParentFeedback(studentId);

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex;
                align-items: center; justify-content: center; padding: 20px;
            `;

            modal.innerHTML = `
                <div style="background: white; border-radius: 8px; padding: 20px; max-width: 600px;
                           width: 100%; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: #1890ff;">ğŸ“¨ ${student.name} í•™ìƒ ë¶€ëª¨ë‹˜ í”¼ë“œë°±</h3>
                        <button onclick="closeParentFeedbackModal()" style="background: none; border: none; font-size: 20px; cursor: pointer;">âœ–ï¸</button>
                    </div>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 20px; white-space: pre-line; font-family: monospace; font-size: 13px; line-height: 1.6;">${feedback}</div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="copyParentFeedback('${studentId}')" style="padding: 8px 16px; background: #1890ff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ğŸ“‹ í´ë¦½ë³´ë“œ ë³µì‚¬
                        </button>
                        <button onclick="finalizeStudent('${studentId}')" style="padding: 8px 16px; background: #52c41a; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            âœ… ìµœì¢… ì™„ë£Œ
                        </button>
                        <button onclick="closeParentFeedbackModal()" style="padding: 8px 16px; background: #d9d9d9; color: #666; border: none; border-radius: 4px; cursor: pointer;">
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            window.currentParentFeedbackModal = modal;
        }

        // ë¶€ëª¨ë‹˜ í”¼ë“œë°± í´ë¦½ë³´ë“œ ë³µì‚¬
        function copyParentFeedback(studentId) {
            const feedback = generateParentFeedback(studentId);
            const student = studentsData.find(s => s.id === studentId);

            navigator.clipboard.writeText(feedback).then(() => {
                showNotification(`${student.name} í•™ìƒì˜ ë¶€ëª¨ë‹˜ í”¼ë“œë°±ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            });
        }

        // ë¶€ëª¨ë‹˜ í”¼ë“œë°± ëª¨ë‹¬ ë‹«ê¸°
        function closeParentFeedbackModal() {
            if (window.currentParentFeedbackModal) {
                document.body.removeChild(window.currentParentFeedbackModal);
                window.currentParentFeedbackModal = null;
            }
        }

        // í•™ìƒ ìµœì¢… ì™„ë£Œ ì²˜ë¦¬
        function finalizeStudent(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            const homework = getHomeworkForStudent(studentId);

            // ìµœì¢… ì™„ë£Œ í‘œì‹œ ì¶”ê°€
            homework.finalized = true;
            homework.finalizedAt = new Date().toISOString();

            // ë°ì´í„° ì €ì¥
            saveHomeworkData();

            // UI ì—…ë°ì´íŠ¸
            renderStudents();

                        -->
</body>
</body>
</html>
